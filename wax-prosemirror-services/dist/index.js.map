{"version":3,"file":"index.js","sources":["../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass.js","../src/Service.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/setPrototypeOf.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/isNativeReflectConstruct.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/typeof.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/assertThisInitialized.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createSuper.js","../src/LayoutService/components/componentPlugin.js","../src/LayoutService/DefaultLayout/DefaultLayout.js","../src/LayoutService/components/LayoutFactory.js","../src/LayoutService/Layout.js","../src/LayoutService/LayoutService.js","../src/lib/ToolGroup.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/taggedTemplateLiteral.js","../src/MenuService/MenuWrapper.js","../src/MenuService/Menu.js","../src/MenuService/MenuCollection.js","../src/MenuService/MenuService.js","../src/lib/Tools.js","../src/LinkService/LinkTool.js","../src/LinkService/LinkService.js","../src/PlaceholderService/pmPlugins/placeholderPlugin.js","../src/PlaceholderService/PlaceholderService.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/arrayWithHoles.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/iterableToArrayLimit.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/arrayLikeToArray.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/unsupportedIterableToArray.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/nonIterableRest.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2.js","../src/OverlayService/usePosition.js","../src/OverlayService/OverlayComponent.js","../src/OverlayService/OverlayService.js","../src/ImageService/fileUpload.js","../src/ImageService/Image.js","../src/ImageService/ImageService.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/arrayWithoutHoles.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/iterableToArray.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/nonIterableSpread.js","../../node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray.js","../src/RulesService/Rules.js","../src/RulesService/RulesService.js","../src/SchemaService/DefaultSchema.js","../src/lib/Middleware.js","../src/SchemaService/ParseRule.js","../src/SchemaService/Node.js","../src/SchemaService/Mark.js","../src/SchemaService/Schema.js","../src/SchemaService/SchemaService.js","../src/ShortCutsService/ShortCuts.js","../src/ShortCutsService/ShortCutsService.js","../src/TrackChangeService/EnableTrackChangeService/EnableTrackChange.js","../src/TrackChangeService/EnableTrackChangeService/EnableTrackChangeService.js","../src/TrackChangeService/track-changes/helpers/removeNode.js","../src/TrackChangeService/AcceptTrackChangeService/AcceptTrackChange.js","../src/TrackChangeService/AcceptTrackChangeService/AcceptTrackChangeService.js","../src/TrackChangeService/RejectTrackChangeService/RejectTrackChange.js","../src/TrackChangeService/RejectTrackChangeService/RejectTrackChangeService.js","../src/TrackChangeService/index.js","../src/TrackChangeService/TrackChangeService.js","../src/TrackChangeService/track-changes/helpers/markDeletion.js","../src/TrackChangeService/track-changes/helpers/markInsertion.js","../src/TrackChangeService/track-changes/helpers/replaceStep.js","../src/TrackChangeService/track-changes/helpers/markWrapping.js","../src/TrackChangeService/track-changes/helpers/replaceAroundStep.js","../src/TrackChangeService/track-changes/helpers/addMarkStep.js","../src/TrackChangeService/track-changes/helpers/removeMarkStep.js","../src/TrackChangeService/track-changes/trackedTransaction.js","../src/BaseService/UndoService/Undo.js","../src/BaseService/UndoService/UndoService.js","../src/BaseService/RedoService/Redo.js","../src/BaseService/RedoService/RedoService.js","../src/BaseService/SaveService/Save.js","../src/BaseService/index.js","../src/BaseService/BaseService.js","../src/InlineAnnotations/CodeService/Code.js","../src/InlineAnnotations/CodeService/CodeService.js","../src/InlineAnnotations/StrongService/Strong.js","../src/InlineAnnotations/StrongService/StrongService.js","../src/InlineAnnotations/EmphasisService/Emphasis.js","../src/InlineAnnotations/EmphasisService/EmphasisService.js","../src/InlineAnnotations/SubscriptService/Subscript.js","../src/InlineAnnotations/SubscriptService/SubscriptService.js","../src/InlineAnnotations/SuperscriptService/Superscript.js","../src/InlineAnnotations/SuperscriptService/SuperscriptService.js","../src/InlineAnnotations/StrikeThroughService/StrikeThrough.js","../src/InlineAnnotations/StrikeThroughService/StrikeThroughService.js","../src/InlineAnnotations/UnderlineService/Underline.js","../src/InlineAnnotations/UnderlineService/UnderlineService.js","../src/InlineAnnotations/SmallCapsService/SmallCaps.js","../src/InlineAnnotations/SmallCapsService/SmallCapsService.js","../src/InlineAnnotations/index.js","../src/InlineAnnotations/InlineAnnotationsService.js","../src/ListsService/BulletListService/BulletList.js","../src/ListsService/BulletListService/BulletListService.js","../src/ListsService/OrderedListService/OrderedList.js","../src/ListsService/OrderedListService/OrderedListService.js","../src/ListsService/JoinUpService/JoinUp.js","../src/ListsService/JoinUpService/JoinUpService.js","../src/ListsService/LiftService/Lift.js","../src/ListsService/LiftService/LiftService.js","../src/ListsService/ListItemService/ListItemService.js","../src/ListsService/index.js","../src/ListsService/ListsService.js","../src/TablesService/InsertTableService/Table.js","../src/TablesService/InsertTableService/InsertTableService.js","../src/TablesService/EditTableService/TableDropDownOptions.js","../src/TablesService/EditTableService/EditTableService.js","../src/TablesService/index.js","../src/TablesService/TablesService.js","../src/TextBlockLevel/ExtractPoetryService/ExtractPoetry.js","../src/TextBlockLevel/ExtractPoetryService/ExtractPoetryService.js","../src/TextBlockLevel/ExtractProseService/ExtractProse.js","../src/TextBlockLevel/ExtractProseService/ExtractProseService.js","../src/TextBlockLevel/ParagraphContinuedService/ParagraphContinued.js","../src/TextBlockLevel/ParagraphContinuedService/ParagraphContinuedService.js","../src/TextBlockLevel/ParagraphService/Paragraph.js","../src/TextBlockLevel/ParagraphService/ParagraphService.js","../src/TextBlockLevel/SourceNoteService/SourceNote.js","../src/TextBlockLevel/SourceNoteService/SourceNoteService.js","../src/TextBlockLevel/BlockQuoteService/BlockQuote.js","../src/TextBlockLevel/BlockQuoteService/BlockQuoteService.js","../src/TextBlockLevel/index.js","../src/TextBlockLevel/TextBlockLevelService.js","../src/DisplayBlockLevel/AuthorService/Author.js","../src/DisplayBlockLevel/AuthorService/AuthorService.js","../src/DisplayBlockLevel/EpigraphPoetryService/EpigraphPoetry.js","../src/DisplayBlockLevel/EpigraphPoetryService/EpigraphPoetryService.js","../src/DisplayBlockLevel/EpigraphProseService/EpigraphProse.js","../src/DisplayBlockLevel/EpigraphProseService/EpigraphProseService.js","../src/DisplayBlockLevel/HeadingService/Heading1.js","../src/DisplayBlockLevel/HeadingService/Heading2.js","../src/DisplayBlockLevel/HeadingService/Heading3.js","../src/DisplayBlockLevel/HeadingService/HeadingService.js","../src/DisplayBlockLevel/SubTitleService/SubTitle.js","../src/DisplayBlockLevel/SubTitleService/SubTitleService.js","../src/DisplayBlockLevel/TitleService/Title.js","../src/DisplayBlockLevel/TitleService/TitleService.js","../src/DisplayBlockLevel/index.js","../src/DisplayBlockLevel/DisplayBlockLevelService.js","../src/NoteService/Note.js","../src/NoteService/helpers/TransformPasted.js","../src/NoteService/Editor.js","../src/NoteService/NoteEditor.js","../src/NoteService/NoteComponent.js","../src/NoteService/NoteService.js","../src/CommentsService/CommentsService.js","../src/CodeBlockService/CodeBlockTool.js","../src/CodeBlockService/CodeBlockService.js","../src/WaxToolGroups/BaseToolGroupService/Base.js","../src/WaxToolGroups/BaseToolGroupService/BaseToolGroupService.js","../src/WaxToolGroups/AnnotationToolGroupService/Annotations.js","../src/WaxToolGroups/AnnotationToolGroupService/AnnotationToolGroupService.js","../src/WaxToolGroups/ListToolGroupService/Lists.js","../src/WaxToolGroups/ListToolGroupService/ListToolGroupService.js","../src/WaxToolGroups/ImageToolGroupService/Images.js","../src/WaxToolGroups/ImageToolGroupService/ImageToolGroupService.js","../src/WaxToolGroups/TableToolGroupService/Tables.js","../src/WaxToolGroups/TableToolGroupService/TableToolGroupService.js","../src/WaxToolGroups/DisplayToolGroupService/Display.js","../src/WaxToolGroups/DisplayToolGroupService/DisplayToolGroupService.js","../src/WaxToolGroups/TextToolGroupService/Text.js","../src/WaxToolGroups/TextToolGroupService/TextToolGroupService.js","../src/WaxToolGroups/NoteToolGroupService/Notes.js","../src/WaxToolGroups/NoteToolGroupService/NoteToolGroupService.js","../src/WaxToolGroups/CodeBlockToolGroupService/CodeBlock.js","../src/WaxToolGroups/CodeBlockToolGroupService/CodeBlockToolGroupService.js","../src/WaxToolGroups/TrackChangeToolGroupService/TrackChange.js","../src/WaxToolGroups/TrackChangeToolGroupService/TrackChangeToolGroupService.js"],"sourcesContent":["export default function _classCallCheck(instance, Constructor) {\n  if (!(instance instanceof Constructor)) {\n    throw new TypeError(\"Cannot call a class as a function\");\n  }\n}","function _defineProperties(target, props) {\n  for (var i = 0; i < props.length; i++) {\n    var descriptor = props[i];\n    descriptor.enumerable = descriptor.enumerable || false;\n    descriptor.configurable = true;\n    if (\"value\" in descriptor) descriptor.writable = true;\n    Object.defineProperty(target, descriptor.key, descriptor);\n  }\n}\n\nexport default function _createClass(Constructor, protoProps, staticProps) {\n  if (protoProps) _defineProperties(Constructor.prototype, protoProps);\n  if (staticProps) _defineProperties(Constructor, staticProps);\n  return Constructor;\n}","class Service {\n  setApp(app) {\n    this.app = app;\n  }\n\n  get container() {\n    return this.app.container;\n  }\n\n  get config() {\n    return this.app.config.get(`config.${this.name}`) || this.app.config;\n  }\n\n  get schema() {\n    return this.app.getSchema();\n  }\n}\n\nexport default Service;\n","export default function _setPrototypeOf(o, p) {\n  _setPrototypeOf = Object.setPrototypeOf || function _setPrototypeOf(o, p) {\n    o.__proto__ = p;\n    return o;\n  };\n\n  return _setPrototypeOf(o, p);\n}","import setPrototypeOf from \"./setPrototypeOf\";\nexport default function _inherits(subClass, superClass) {\n  if (typeof superClass !== \"function\" && superClass !== null) {\n    throw new TypeError(\"Super expression must either be null or a function\");\n  }\n\n  subClass.prototype = Object.create(superClass && superClass.prototype, {\n    constructor: {\n      value: subClass,\n      writable: true,\n      configurable: true\n    }\n  });\n  if (superClass) setPrototypeOf(subClass, superClass);\n}","export default function _getPrototypeOf(o) {\n  _getPrototypeOf = Object.setPrototypeOf ? Object.getPrototypeOf : function _getPrototypeOf(o) {\n    return o.__proto__ || Object.getPrototypeOf(o);\n  };\n  return _getPrototypeOf(o);\n}","export default function _isNativeReflectConstruct() {\n  if (typeof Reflect === \"undefined\" || !Reflect.construct) return false;\n  if (Reflect.construct.sham) return false;\n  if (typeof Proxy === \"function\") return true;\n\n  try {\n    Date.prototype.toString.call(Reflect.construct(Date, [], function () {}));\n    return true;\n  } catch (e) {\n    return false;\n  }\n}","export default function _typeof(obj) {\n  \"@babel/helpers - typeof\";\n\n  if (typeof Symbol === \"function\" && typeof Symbol.iterator === \"symbol\") {\n    _typeof = function _typeof(obj) {\n      return typeof obj;\n    };\n  } else {\n    _typeof = function _typeof(obj) {\n      return obj && typeof Symbol === \"function\" && obj.constructor === Symbol && obj !== Symbol.prototype ? \"symbol\" : typeof obj;\n    };\n  }\n\n  return _typeof(obj);\n}","export default function _assertThisInitialized(self) {\n  if (self === void 0) {\n    throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");\n  }\n\n  return self;\n}","import _typeof from \"../../helpers/esm/typeof\";\nimport assertThisInitialized from \"./assertThisInitialized\";\nexport default function _possibleConstructorReturn(self, call) {\n  if (call && (_typeof(call) === \"object\" || typeof call === \"function\")) {\n    return call;\n  }\n\n  return assertThisInitialized(self);\n}","import getPrototypeOf from \"./getPrototypeOf\";\nimport isNativeReflectConstruct from \"./isNativeReflectConstruct\";\nimport possibleConstructorReturn from \"./possibleConstructorReturn\";\nexport default function _createSuper(Derived) {\n  return function () {\n    var Super = getPrototypeOf(Derived),\n        result;\n\n    if (isNativeReflectConstruct()) {\n      var NewTarget = getPrototypeOf(this).constructor;\n      result = Reflect.construct(Super, arguments, NewTarget);\n    } else {\n      result = Super.apply(this, arguments);\n    }\n\n    return possibleConstructorReturn(this, result);\n  };\n}","import React, { Component } from \"react\";\nimport { useInjection } from \"wax-prosemirror-core\";\n\nclass UpdateView extends Component {\n  constructor(props) {\n    super(props);\n\n    this.state = {\n      view: this.props.view\n    };\n  }\n\n  updateView(view) {\n    this.setState(view);\n  }\n\n  render() {\n    return this.props.children({ view: this.state.view });\n  }\n}\n\nconst ComponentPlugin = renderArea => layoutProps => {\n  const { instance } = useInjection(\"Layout\");\n\n  const components = instance.render(renderArea);\n\n  return components\n    ? components.map(({ component: Component, componentProps }, key) => {\n        return (\n          <Component\n            key={`${renderArea}-${key}`}\n            {...layoutProps}\n            {...componentProps}\n          />\n        );\n      })\n    : null;\n};\nexport default ComponentPlugin;\n","import React from 'react'\n\nconst DefaultLayout = ({ editor }) => <>{editor}</>\n\nexport default DefaultLayout\n","import React from \"react\";\n\nexport default Component => props => <Component {...props} />;\n","import { injectable } from \"inversify\";\nimport DefaultLayout from \"./DefaultLayout/DefaultLayout\";\nimport LayoutFactory from \"./components/LayoutFactory\";\n\n@injectable()\nexport default class Layout {\n  components = [];\n  layoutComponent = LayoutFactory(DefaultLayout);\n  addComponent(renderArea, component, componentProps) {\n    if (!this.components[renderArea]) {\n      this.createArea(renderArea);\n    }\n    const size = this.components[renderArea].size;\n    this.components[renderArea].set(size + 1, { component, componentProps });\n    return this;\n  }\n\n  render(renderArea) {\n    if (!this.components[renderArea]) return null;\n    return this.getArray(this.components[renderArea]);\n  }\n\n  createArea(area) {\n    this.components[area] = new Map();\n  }\n\n  getArray(iterator) {\n    const components = [];\n    iterator.forEach(component => components.push(component));\n    return components;\n  }\n\n  setLayout(component) {\n    this.layoutComponent = LayoutFactory(component);\n  }\n}\n","import Service from \"../Service\";\nimport Layout from \"./Layout\";\n\nexport default class LayoutService extends Service {\n  name = \"LayoutService\";\n\n  register() {\n    this.container\n      .bind(\"Layout\")\n      .to(Layout)\n      .inSingletonScope();\n  }\n}\n","import React, { useState } from \"react\";\nimport { injectable } from \"inversify\";\nimport { ToolGroupComponent } from \"wax-prosemirror-components\";\nimport { v4 as uuidv4 } from \"uuid\";\n\n@injectable()\nexport default class ToolGroup {\n  _config = {};\n  title = \"\";\n  _tools = [];\n  constructor() {}\n  setGroupConfig(config) {\n    this._config = config;\n  }\n\n  excludeIncludeTools() {\n    const { exclude = [], include = [] } = this._config;\n\n    if (include.length > 0) {\n      this._tools.map(tool => {\n        if (include.includes(tool.constructor.name)) {\n          tool.displayTool();\n        } else {\n          tool.hideTool();\n        }\n      });\n    } else {\n      this._tools.map(tool => {\n        if (exclude.includes(tool.constructor.name)) {\n          tool.hideTool();\n        }\n      });\n    }\n  }\n\n  addToolIntoMore() {\n    const { more = [] } = this._config;\n    if (more.length > 0) {\n      this._tools.map(tool => {\n        if (more.includes(tool.constructor.name)) {\n          tool.hideInToolGroup();\n        } else {\n          tool.displayInToolGroup();\n        }\n      });\n    }\n  }\n\n  set tools(tools) {\n    this._tools = tools;\n  }\n\n  renderTools(view) {\n    const { name } = this.constructor;\n    return (\n      <ToolGroupComponent\n        key={uuidv4()}\n        view={view}\n        tools={this._tools}\n        title={this.title}\n        name={name}\n      />\n    );\n  }\n}\n","export default function _taggedTemplateLiteral(strings, raw) {\n  if (!raw) {\n    raw = strings.slice(0);\n  }\n\n  return Object.freeze(Object.defineProperties(strings, {\n    raw: {\n      value: Object.freeze(raw)\n    }\n  }));\n}","import React from \"react\";\nimport styled from \"styled-components\";\n\nimport { map } from \"lodash\";\n\nconst MainMenu = styled.div`\n  background: #fff;\n  padding: 2px 2px 2px 0;\n  position: relative;\n  background: transparent;\n`;\n\nconst MainMenuBar = ({ items = [], view }) => {\n  return (\n    <MainMenu key=\"MainMenu\">\n      {map(items, item => item.renderTools(view))}\n    </MainMenu>\n  );\n};\n\nexport default MainMenuBar;\n","import React, { useMemo, useContext } from 'react';\nimport { injectable } from 'inversify';\nimport { WaxContext } from 'wax-prosemirror-core';\nimport ToolGroup from '../lib/ToolGroup';\nimport MenuWrapper from './MenuWrapper';\n\n@injectable()\nclass Menu {\n  toolGroups = [];\n  config = {};\n  name = '';\n  constructor(config, createTools) {\n    this.name = config.name;\n    this.config = config;\n    this.toolGroups = createTools(this.config.toolGroups);\n    this.excludeIncludeTools();\n    this.addToolIntoMore();\n  }\n\n  excludeIncludeTools() {\n    this.toolGroups.forEach(toolGroup => {\n      if (toolGroup instanceof ToolGroup) {\n        toolGroup.excludeIncludeTools();\n      }\n    });\n  }\n\n  addToolIntoMore() {\n    this.toolGroups.forEach(toolGroup => {\n      if (toolGroup instanceof ToolGroup) {\n        toolGroup.addToolIntoMore();\n      }\n    });\n  }\n\n  render() {\n    return () => {\n      const {\n        view: { main },\n        activeView,\n      } = useContext(WaxContext);\n      const Bar = useMemo(() => (\n        <MenuWrapper items={this.toolGroups} view={activeView || {}} />\n      ));\n      return <>{Bar}</>;\n    };\n  }\n}\n\nexport default Menu;\n","import { injectable, multiInject } from 'inversify';\n\n@injectable()\nclass MenuCollection {\n  menus = [];\n  constructor(@multiInject('Menu') menus) {\n    this.menus = menus;\n  }\n\n  getMenu(name) {\n    return this.menus.find(menu => menu.name === name);\n  }\n}\n\nexport default MenuCollection;\n","import { isPlainObject, isFunction } from 'lodash';\nimport Service from '../Service';\nimport Menu from './Menu';\nimport MenuCollection from './MenuCollection';\n\nclass MenuService extends Service {\n  name = 'MenuService';\n  boot() {\n    const { menus } = this.container.get('MenuCollection');\n    const layout = this.container.get('Layout');\n    menus.forEach(menu => {\n      layout.addComponent(menu.config.templateArea, menu.render());\n    });\n  }\n\n  register() {\n    /* create Menu Factory */\n    this.config.map(conf => {\n      this.container.bind('Menu').toFactory(context => {\n        return new Menu(conf, context.container.get('createTools'));\n      });\n    });\n\n    /*create MenuCollection of Menus */\n    this.container.bind('MenuCollection').to(MenuCollection).inSingletonScope();\n\n    /* create factory of tools */\n    this.container.bind('createTools').toFactory(context => {\n      return configTools => {\n        const tools = [];\n        configTools.forEach(tool => {\n          try {\n            let tl = {};\n            if (isPlainObject(tool)) {\n              tl = context.container.get(tool.name);\n              tl.setGroupConfig(tool);\n            } else if (isFunction(tool)) {\n              tl = context.container.get(tool());\n            } else {\n              tl = context.container.get(tool);\n            }\n            tools.push(tl);\n          } catch (error) {\n            throw Error(\n              `Could not load Service ${tool.name}. Please configure service through config`,\n            );\n          }\n        });\n        return tools;\n      };\n    });\n  }\n}\nexport default MenuService;\n","import React from 'react';\nimport { v4 as uuidv4 } from 'uuid';\nimport { isEmpty } from 'lodash';\nimport { injectable, inject } from 'inversify';\nimport { Button } from 'wax-prosemirror-components';\n\n@injectable()\nclass Tools {\n  title = 'title';\n  content = 'content';\n  _isDisplayed = true;\n  _isHiddenInToolGroup = false;\n  onlyOnMain = false;\n  config = {};\n  pmplugins = {};\n\n  constructor(@inject('Config') config, @inject('PmPlugins') pmplugins) {\n    this.config = config;\n    this.pmplugins = pmplugins;\n  }\n\n  get run() {\n    return true;\n  }\n\n  get enable() {\n    return () => true;\n  }\n\n  select() {\n    return () => true;\n  }\n\n  get active() {\n    return () => false;\n  }\n\n  toJSON() {\n    return {\n      title: this.title,\n      content: this.content,\n      active: this.active,\n      run: this.run,\n      enable: this.enable,\n      select: this.select,\n      onlyOnMain: this.onlyOnMain,\n    };\n  }\n\n  renderTool(view) {\n    if (isEmpty(view)) return null;\n\n    return this._isDisplayed ? (\n      <Button key={uuidv4()} item={this.toJSON()} view={view} />\n    ) : null;\n  }\n\n  displayTool() {\n    this._isDisplayed = true;\n  }\n\n  hideTool() {\n    this._isDisplayed = false;\n  }\n\n  isDisplayed() {\n    return this._isDisplayed;\n  }\n\n  displayInToolGroup() {\n    this._isHiddenInToolGroup = false;\n  }\n\n  hideInToolGroup() {\n    this._isHiddenInToolGroup = true;\n  }\n\n  isIntoMoreSection() {\n    return this._isHiddenInToolGroup;\n  }\n}\nexport default Tools;\n","import { injectable } from \"inversify\";\nimport { toggleMark } from \"prosemirror-commands\";\nimport { Commands } from \"wax-prosemirror-utilities\";\nimport Tools from \"../lib/Tools\";\nimport { icons } from \"wax-prosemirror-components\";\n\n@injectable()\nexport default class LinkTool extends Tools {\n  title = \"Add or remove link\";\n  content = icons.link;\n\n  get run() {\n    return (state, dispatch) => {\n      if (Commands.markActive(state.config.schema.marks.link)(state)) {\n        toggleMark(state.config.schema.marks.link)(state, dispatch);\n        return true;\n      }\n      Commands.createLink(state, dispatch);\n    };\n  }\n\n  get enable() {\n    return state => {\n      return Commands.isOnSameTextBlock(state);\n    };\n  }\n\n  get active() {\n    return state => {\n      return Commands.markActive(state.config.schema.marks.link)(state);\n    };\n  }\n}\n","import Service from '../Service';\nimport { LinkComponent } from 'wax-prosemirror-components';\nimport { linkMark } from 'wax-prosemirror-schema';\nimport LinkTool from './LinkTool';\n// import { OverlayService } from '../..';\n\nexport default class LinkService extends Service {\n  name = 'LinkService';\n\n  boot() {\n    const createOverlay = this.container.get('CreateOverlay');\n    createOverlay(\n      LinkComponent,\n      {},\n      {\n        markType: 'link',\n        followCursor: false,\n        selection: false,\n      },\n    );\n  }\n\n  register() {\n    this.container.bind('Link').to(LinkTool);\n    const createMark = this.container.get('CreateMark');\n    createMark(\n      {\n        link: linkMark,\n      },\n      { toWaxSchema: true },\n    );\n  }\n\n  // dependencies = [new OverlayService()];\n}\n","import { Plugin, PluginKey } from \"prosemirror-state\";\nimport { Decoration, DecorationSet } from \"prosemirror-view\";\n\nexport default key =>\n  new Plugin({\n    key: new PluginKey(key),\n    state: {\n      init: function init() {\n        return DecorationSet.empty;\n      },\n      apply: function apply(tr, set) {\n        // Adjust decoration positions to changes made by the transaction\n        set = set.map(tr.mapping, tr.doc);\n        // See if the transaction adds or removes any placeholders\n        const action = tr.getMeta(this);\n        if (action && action.add) {\n          const widget = document.createElement(\"placeholder\");\n          const deco = Decoration.widget(action.add.pos, widget, {\n            id: action.add.id\n          });\n          set = set.add(tr.doc, [deco]);\n        } else if (action && action.remove) {\n          set = set.remove(\n            set.find(null, null, spec => spec.id === action.remove.id)\n          );\n        }\n        return set;\n      }\n    },\n    props: {\n      decorations: function decorations(state) {\n        return this.getState(state);\n      }\n    }\n  });\n","import Service from \"../Service\";\nimport placeholderPlugin from \"./pmPlugins/placeholderPlugin\";\nconst PLUGIN_KEY = \"imagePlaceHolder\";\n\nexport default class PlaceholderService extends Service {\n  name = \"PlaceholderService\";\n\n  boot() {\n    this.app.PmPlugins.add(PLUGIN_KEY, placeholderPlugin(PLUGIN_KEY));\n  }\n}\n","export default function _arrayWithHoles(arr) {\n  if (Array.isArray(arr)) return arr;\n}","export default function _iterableToArrayLimit(arr, i) {\n  if (typeof Symbol === \"undefined\" || !(Symbol.iterator in Object(arr))) return;\n  var _arr = [];\n  var _n = true;\n  var _d = false;\n  var _e = undefined;\n\n  try {\n    for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) {\n      _arr.push(_s.value);\n\n      if (i && _arr.length === i) break;\n    }\n  } catch (err) {\n    _d = true;\n    _e = err;\n  } finally {\n    try {\n      if (!_n && _i[\"return\"] != null) _i[\"return\"]();\n    } finally {\n      if (_d) throw _e;\n    }\n  }\n\n  return _arr;\n}","export default function _arrayLikeToArray(arr, len) {\n  if (len == null || len > arr.length) len = arr.length;\n\n  for (var i = 0, arr2 = new Array(len); i < len; i++) {\n    arr2[i] = arr[i];\n  }\n\n  return arr2;\n}","import arrayLikeToArray from \"./arrayLikeToArray\";\nexport default function _unsupportedIterableToArray(o, minLen) {\n  if (!o) return;\n  if (typeof o === \"string\") return arrayLikeToArray(o, minLen);\n  var n = Object.prototype.toString.call(o).slice(8, -1);\n  if (n === \"Object\" && o.constructor) n = o.constructor.name;\n  if (n === \"Map\" || n === \"Set\") return Array.from(n);\n  if (n === \"Arguments\" || /^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)) return arrayLikeToArray(o, minLen);\n}","export default function _nonIterableRest() {\n  throw new TypeError(\"Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import arrayWithHoles from \"./arrayWithHoles\";\nimport iterableToArrayLimit from \"./iterableToArrayLimit\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray\";\nimport nonIterableRest from \"./nonIterableRest\";\nexport default function _slicedToArray(arr, i) {\n  return arrayWithHoles(arr) || iterableToArrayLimit(arr, i) || unsupportedIterableToArray(arr, i) || nonIterableRest();\n}","export default function _defineProperty(obj, key, value) {\n  if (key in obj) {\n    Object.defineProperty(obj, key, {\n      value: value,\n      enumerable: true,\n      configurable: true,\n      writable: true\n    });\n  } else {\n    obj[key] = value;\n  }\n\n  return obj;\n}","import defineProperty from \"./defineProperty\";\n\nfunction ownKeys(object, enumerableOnly) {\n  var keys = Object.keys(object);\n\n  if (Object.getOwnPropertySymbols) {\n    var symbols = Object.getOwnPropertySymbols(object);\n    if (enumerableOnly) symbols = symbols.filter(function (sym) {\n      return Object.getOwnPropertyDescriptor(object, sym).enumerable;\n    });\n    keys.push.apply(keys, symbols);\n  }\n\n  return keys;\n}\n\nexport default function _objectSpread2(target) {\n  for (var i = 1; i < arguments.length; i++) {\n    var source = arguments[i] != null ? arguments[i] : {};\n\n    if (i % 2) {\n      ownKeys(Object(source), true).forEach(function (key) {\n        defineProperty(target, key, source[key]);\n      });\n    } else if (Object.getOwnPropertyDescriptors) {\n      Object.defineProperties(target, Object.getOwnPropertyDescriptors(source));\n    } else {\n      ownKeys(Object(source)).forEach(function (key) {\n        Object.defineProperty(target, key, Object.getOwnPropertyDescriptor(source, key));\n      });\n    }\n  }\n\n  return target;\n}","import { useState, useContext, useLayoutEffect, useCallback } from \"react\";\nimport { isObject } from \"lodash\";\nimport { WaxContext } from \"wax-prosemirror-core\";\nimport { DocumentHelpers } from \"wax-prosemirror-utilities\";\n\nconst defaultOverlay = {\n  left: null,\n  top: null,\n  from: null,\n  to: null,\n  mark: null\n};\n\nexport default options => {\n  const { view: { main }, activeView } = useContext(WaxContext);\n\n  const [position, setPosition] = useState({\n    position: \"absolute\",\n    ...defaultOverlay\n  });\n\n  let mark = {};\n\n  /* Sets Default position at the end of the annotation. You\n  can overwrite the default position in your component.\n  Check: wax-prosemirror-components/src/components/comments/CommentBubbleComponent.js\n  for reposition the create new comment component.\n */\n  const calculatePosition = (activeView, from, to) => {\n    const WaxSurface = activeView.dom.getBoundingClientRect();\n    const start = activeView.coordsAtPos(from);\n    const end = activeView.coordsAtPos(to);\n    const left = end.left;\n    const top = end.top + 20;\n    return {\n      top,\n      left\n    };\n  };\n\n  const displayOnSelection = (activeView, options) => {\n    const { selection } = activeView.state;\n    const { from, to } = selection;\n    if (from === to) return defaultOverlay;\n    const { left, top } = calculatePosition(activeView, from, to);\n    return {\n      left,\n      top,\n      from,\n      to,\n      selection\n    };\n  };\n\n  const displayOnMark = (activeView, options) => {\n    const { markType, followCursor } = options;\n    const PMmark = activeView.state.schema.marks[markType];\n    mark = DocumentHelpers.getSelectionMark(activeView.state, PMmark);\n\n    if (!isObject(mark)) return defaultOverlay;\n    const { from, to } = followCursor ? activeView.state.selection : mark;\n\n    const { left, top } = calculatePosition(activeView, from, to);\n\n    return {\n      left,\n      top,\n      from,\n      to,\n      mark\n    };\n  };\n\n  const updatePosition = useCallback((followCursor = true) => {\n    if (Object.keys(activeView).length === 0) return defaultOverlay;\n\n    const { markType, selection } = options;\n\n    if (selection) return displayOnSelection(activeView, options);\n\n    return displayOnMark(activeView, options);\n  });\n\n  useLayoutEffect(\n    () => {\n      setPosition({\n        position: \"absolute\",\n        ...updatePosition(options.followCursor)\n      });\n    },\n    [JSON.stringify(updatePosition(options.followCursor))]\n  );\n\n  return [position, setPosition, mark];\n};\n","import React, { useMemo } from \"react\";\nimport usePosition from \"./usePosition\";\nimport { Overlay } from \"wax-prosemirror-components\";\n\nexport default (Component, markType) => props => {\n  const [position, setPosition, mark] = usePosition(markType);\n  const component = useMemo(\n    () => (\n      <Component\n        setPosition={setPosition}\n        mark={mark}\n        position={position}\n        {...props}\n      />\n    ),\n    [JSON.stringify(mark), position]\n  );\n  const visible = position.left ? true : false;\n\n  return <Overlay position={position}>{visible && component}</Overlay>;\n};\n","import Service from \"../Service\";\nimport OverlayComponent from \"./OverlayComponent\";\n\nexport default class OverlayService extends Service {\n  boot() {}\n\n  register() {\n    this.container.bind(\"CreateOverlay\").toFactory(context => {\n      return (Component, componentProps, options) => {\n        const layout = context.container.get(\"Layout\");\n        layout.addComponent(\n          \"waxOverlays\",\n          OverlayComponent(Component, options),\n          componentProps\n        );\n      };\n    });\n  }\n}\n","const findPlaceholder = (state, id, placeholderPlugin) => {\n  const decos = placeholderPlugin.getState(state);\n  const found = decos.find(null, null, spec => spec.id === id);\n  return found.length ? found[0].from : null;\n};\n\nexport default (view, fileUpload, placeholderPlugin) => file => {\n  const { state } = view;\n\n  // A fresh object to act as the ID for this upload\n  const id = {};\n\n  // Replace the selection with a placeholder\n  const { tr } = state;\n  if (!tr.selection.empty) tr.deleteSelection();\n\n  tr.setMeta(placeholderPlugin, {\n    add: { id, pos: tr.selection.from }\n  });\n\n  view.dispatch(tr);\n  fileUpload(file).then(\n    url => {\n      const pos = findPlaceholder(view.state, id, placeholderPlugin);\n      // If the content around the placeholder has been deleted, drop\n      // the image\n      if (pos == null) {\n        return;\n      }\n      // Otherwise, insert it at the placeholder's position, and remove\n      // the placeholder\n      view.dispatch(\n        state.tr\n          .replaceWith(\n            pos,\n            pos,\n            view.state.schema.nodes.image.create({\n              src: url\n            })\n          )\n          .setMeta(placeholderPlugin, { remove: { id } })\n      );\n    },\n    () => {\n      // On failure, just clean up the placeholder\n      view.dispatch(tr.setMeta(placeholderPlugin, { remove: { id } }));\n    }\n  );\n};\n","import React from 'react';\nimport { v4 as uuidv4 } from 'uuid';\nimport { isEmpty } from 'lodash';\nimport { injectable } from 'inversify';\nimport { icons, ImageUpload } from 'wax-prosemirror-components';\nimport { Commands } from 'wax-prosemirror-utilities';\nimport Tools from '../lib/Tools';\nimport fileUpload from './fileUpload';\n\nexport default\n@injectable()\nclass Image extends Tools {\n  title = 'Insert image';\n  content = icons.image;\n\n  get run() {\n    return () => true;\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get enable() {\n    return state => {\n      return Commands.canInsert(state.config.schema.nodes.image)(state);\n    };\n  }\n\n  renderTool(view) {\n    if (isEmpty(view)) return null;\n    const upload = fileUpload(\n      view,\n      this.config.get('fileUpload'),\n      this.pmplugins.get('imagePlaceHolder'),\n    );\n    return this._isDisplayed ? (\n      <ImageUpload\n        key={uuidv4()}\n        item={this.toJSON()}\n        fileUpload={upload}\n        view={view}\n      />\n    ) : null;\n  }\n}\n","import { imageNode } from 'wax-prosemirror-schema';\nimport Service from '../Service';\nimport Image from './Image';\n\nexport default class ImageService extends Service {\n  name = 'ImageService';\n\n  register() {\n    this.container.bind('Image').to(Image);\n    const createNode = this.container.get('CreateNode');\n    createNode(\n      {\n        image: imageNode,\n      },\n      { toWaxSchema: true },\n    );\n  }\n}\n","import arrayLikeToArray from \"./arrayLikeToArray\";\nexport default function _arrayWithoutHoles(arr) {\n  if (Array.isArray(arr)) return arrayLikeToArray(arr);\n}","export default function _iterableToArray(iter) {\n  if (typeof Symbol !== \"undefined\" && Symbol.iterator in Object(iter)) return Array.from(iter);\n}","export default function _nonIterableSpread() {\n  throw new TypeError(\"Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\");\n}","import arrayWithoutHoles from \"./arrayWithoutHoles\";\nimport iterableToArray from \"./iterableToArray\";\nimport unsupportedIterableToArray from \"./unsupportedIterableToArray\";\nimport nonIterableSpread from \"./nonIterableSpread\";\nexport default function _toConsumableArray(arr) {\n  return arrayWithoutHoles(arr) || iterableToArray(arr) || unsupportedIterableToArray(arr) || nonIterableSpread();\n}","import { injectable } from \"inversify\";\nimport {\n  inputRules,\n  wrappingInputRule,\n  textblockTypeInputRule,\n  smartQuotes\n} from \"prosemirror-inputrules\";\n\n@injectable()\nclass Rules {\n  constructor(plugins, schema) {\n    this.PmPlugins = plugins;\n\n    this.schema = schema;\n    this.extendedRules = this.allRules();\n  }\n\n  addRule(rules) {\n    this.extendedRules.push(...rules);\n  }\n\n  createRules() {\n    const rulesCreated = inputRules({ rules: this.extendedRules });\n    this.PmPlugins.add(\"rules\", rulesCreated);\n  }\n\n  allRules() {\n    return [\n      ...smartQuotes,\n      // > blockquote\n      wrappingInputRule(/^\\s*>\\s$/, this.schema.nodes.blockquote),\n\n      // 1. ordered list\n      wrappingInputRule(\n        /^(\\d+)\\.\\s$/,\n        this.schema.nodes.orderedlist,\n        match => ({ order: +match[1] }),\n        (match, node) => node.childCount + node.attrs.order === +match[1]\n      ),\n\n      // * bullet list\n      wrappingInputRule(/^\\s*([-+*])\\s$/, this.schema.nodes.bulletlist),\n\n      // ``` code block\n      // textblockTypeInputRule(/^```$/, this.schema.nodes.code_block),\n\n      // # heading\n      textblockTypeInputRule(\n        new RegExp(\"^(#{1,6})\\\\s$\"),\n        this.schema.nodes.heading,\n        match => ({ level: match[1].length })\n      )\n    ];\n  }\n}\n\nexport default Rules;\n","import Service from '../Service';\nimport Rules from './Rules';\n\nexport default class RulesService extends Service {\n  name = 'RulesService';\n\n  boot() {\n    const configRules = this.config;\n    const rules = this.container.get('Rules');\n    rules.addRule(configRules);\n    rules.createRules();\n  }\n\n  register() {\n    const { PmPlugins } = this.app;\n\n    this.container\n      .bind('Rules')\n      .toDynamicValue(() => {\n        const {\n          schema: { schema },\n        } = this.app;\n\n        return new Rules(PmPlugins, schema);\n      })\n      .inSingletonScope();\n  }\n}\n","import { SchemaHelpers } from \"wax-prosemirror-utilities\";\n\nexport default {\n  nodes: {\n    doc: {\n      content: \"block+\"\n    },\n    text: {\n      group: \"inline\"\n    },\n    hard_break: {\n      inline: true,\n      group: \"inline\",\n      selectable: false,\n      parseDOM: [{ tag: \"br\" }],\n      toDOM() {\n        return [\"br\"];\n      }\n    },\n    paragraph: {\n      group: \"block\",\n      content: \"inline*\",\n      attrs: {\n        id: { default: \"\" },\n        class: { default: \"paragraph\" },\n        track: { default: [] },\n        group: { default: \"\" }\n      },\n      parseDOM: [\n        {\n          tag: \"p.paragraph\",\n          getAttrs(dom) {\n            return {\n              id: dom.dataset.id,\n              class: dom.getAttribute(\"class\"),\n              track: SchemaHelpers.parseTracks(dom.dataset.track),\n              group: dom.dataset.group\n            };\n          }\n        }\n      ],\n      toDOM(node) {\n        const attrs = SchemaHelpers.blockLevelToDOM(node);\n        return [\"p\", attrs, 0];\n      }\n    }\n  },\n  marks: {}\n};\n","export default class Middleware {\n  constructor() {\n    // Array prototype last\n    if (!Array.prototype.last) {\n      Array.prototype.last = function() {\n        return this[this.length - 1];\n      };\n    }\n\n    // Array prototype reduceOneRight\n    if (!Array.prototype.reduceOneRight) {\n      Array.prototype.reduceOneRight = function() {\n        return this.slice(0, -1);\n      };\n    }\n  }\n\n  use(fn) {\n    this.go = (stack => (...args) =>\n      stack(...args.reduceOneRight(), () => {\n        let _next = args.last();\n        fn.apply(this, [\n          ...args.reduceOneRight(),\n          _next.bind.apply(_next, [null, ...args.reduceOneRight()])\n        ]);\n      }))(this.go);\n  }\n\n  go(...args) {\n    let _next = args.last();\n    _next.apply(this, args.reduceOneRight());\n  }\n}\n","import { omit } from \"lodash\";\nimport Middleware from \"../lib/Middleware\";\n\nexport default class ParseRule {\n  tag = null;\n  style = null;\n  exporter = null;\n  defaultMiddleware = (hook, next) => {\n    hook = {};\n    next();\n  };\n\n  constructor({ getAttrs, tag, style }) {\n    this.tag = tag;\n    this.style = style;\n    // if (getAttrs) {\n    this.exporter = new Middleware();\n    // }\n    this.addStack(getAttrs);\n  }\n\n  addStack(getAttrs) {\n    if (getAttrs) {\n      this.exporter.use(getAttrs);\n    } else {\n      this.exporter.use(this.defaultMiddleware);\n    }\n  }\n\n  parseSchema(exporter) {\n    let rule = {};\n    if (this.tag) {\n      rule = { tag: this.tag };\n    }\n\n    if (this.style) {\n      rule = { style: this.style };\n    }\n\n    if (this.exporter) {\n      rule.getAttrs = dom => {\n        let hooks = {};\n\n        exporter.go({ dom }, hook => {\n          hooks = hook;\n        });\n        return omit(hooks, [\"dom\"]);\n      };\n    }\n\n    return rule;\n  }\n\n  combineRules() {\n    const exporter = this.exporter;\n    return this.parseSchema(exporter);\n  }\n}\n","import { isPlainObject } from \"lodash\";\nimport ParseRule from \"./ParseRule\";\nimport Middleware from \"../lib/Middleware\";\n\nexport default class Node {\n  name = \"\";\n  importer = {};\n\n  atom = false;\n  inline = false;\n  isolating = false;\n  draggable = false;\n  group = \"\";\n  content = \"\";\n  _attrs = {};\n  _parseRules = [];\n\n  constructor(name) {\n    this.name = name;\n    this.importer = new Middleware();\n  }\n\n  fromJSON(config) {\n    for (let key in config) {\n      let value = config[key];\n      this[key] = value;\n    }\n  }\n\n  set toDOM(value) {\n    this.importer.use(value);\n  }\n\n  set attrs(value) {\n    Object.assign(this._attrs, value);\n  }\n\n  set parseDOM(parseDom) {\n    let values = parseDom;\n    if (isPlainObject(parseDom)) {\n      values = [parseDom];\n    }\n    values.forEach(value => {\n      let parseRule = this._parseRules.find(parseRule => {\n        if (value.tag) return parseRule.tag === value.tag;\n        if (value.style) return parseRule.style === value.style;\n        return false;\n      });\n      if (!parseRule) {\n        parseRule = new ParseRule(value);\n        this._parseRules.push(parseRule);\n      }\n      parseRule.addStack(value.getAttrs);\n    });\n  }\n\n  toJSON() {\n    const importer = this.importer;\n\n    return {\n      atom: this.atom,\n      inline: this.inline,\n      group: this.group,\n      content: this.content,\n      isolating: this.isolating,\n      draggable: this.draggable,\n      attrs: this._attrs,\n      parseDOM: this._parseRules.map(rule => rule.combineRules()),\n      toDOM: node => {\n        let hooks = {};\n\n        importer.go({ node }, hook => {\n          hooks = hook;\n        });\n        return hooks.value;\n      }\n    };\n  }\n}\n","import { isPlainObject } from \"lodash\";\nimport ParseRule from \"./ParseRule\";\nimport Middleware from \"../lib/Middleware\";\n\nexport default class Mark {\n  name = \"\";\n  importer = {};\n\n  inline = false;\n  group = \"\";\n  content = \"\";\n  draggable = false;\n  inclusive = true;\n  _attrs = {};\n  _parseRules = [];\n\n  constructor(name) {\n    this.name = name;\n    this.importer = new Middleware();\n  }\n\n  fromJSON(config) {\n    for (let key in config) {\n      let value = config[key];\n      this[key] = value;\n    }\n  }\n\n  set toDOM(value) {\n    this.importer.use(value);\n  }\n\n  set attrs(value) {\n    Object.assign(this._attrs, value);\n  }\n\n  set parseDOM(parseDom) {\n    let values = parseDom;\n    if (isPlainObject(parseDom)) {\n      values = [parseDom];\n    }\n    values.forEach(value => {\n      let parseRule = this._parseRules.find(parseRule => {\n        if (value.tag) return parseRule.tag === value.tag;\n        if (value.style) return parseRule.style === value.style;\n        return false;\n      });\n      if (!parseRule) {\n        parseRule = new ParseRule(value);\n        this._parseRules.push(parseRule);\n      }\n      parseRule.addStack(value.getAttrs);\n    });\n  }\n\n  toJSON() {\n    const importer = this.importer;\n\n    return {\n      inline: this.inline,\n      group: this.group,\n      content: this.content,\n      draggable: this.draggable,\n      inclusive: this.inclusive,\n      attrs: this._attrs,\n      parseDOM: this._parseRules.map(rule => rule.combineRules()),\n      toDOM: node => {\n        let hooks = {};\n\n        importer.go({ node }, hook => {\n          hooks = hook;\n        });\n        return hooks.value;\n      }\n    };\n  }\n}\n","import { Schema as PmPschema } from \"prosemirror-model\";\nimport { injectable } from \"inversify\";\nimport DefaultSchema from \"./DefaultSchema\";\n\nimport Node from \"./Node\";\nimport Mark from \"./Mark\";\n\n@injectable()\nexport default class Schema {\n  _nodes = {};\n  _marks = {};\n  prosemirrorSchema = { nodes: {}, marks: {} };\n  schema = null;\n\n  addNode(schemaConfig) {\n    const name = Object.keys(schemaConfig)[0];\n    const config = schemaConfig[name];\n\n    const node = new Node(name);\n    let nd = {};\n\n    if ((nd = this.has(node))) {\n      nd.fromJSON(config);\n      return nd;\n    } else {\n      node.fromJSON(config);\n      this.addSchema(node);\n\n      return { [name]: node };\n    }\n  }\n\n  addMark(schemaConfig) {\n    const name = Object.keys(schemaConfig)[0];\n    const config = schemaConfig[name];\n\n    const mark = new Mark(name);\n    let mr = {};\n    if ((mr = this.has(mark))) {\n      mr.fromJSON(config);\n      return mr;\n    } else {\n      mark.fromJSON(config);\n      this.addSchema(mark);\n      return { [name]: mark };\n    }\n  }\n\n  has(instance) {\n    if (instance instanceof Node) {\n      return this._nodes[instance.name] ? this._nodes[instance.name] : false;\n    }\n    if (instance instanceof Mark) {\n      return this._marks[instance.name] ? this._marks[instance.name] : false;\n    }\n  }\n\n  addSchema(instance) {\n    if (instance instanceof Node) {\n      return this._nodes[instance.name]\n        ? this._nodes[instance.name]\n        : Object.assign(this._nodes, {\n            [instance.name]: instance\n          });\n    }\n\n    if (instance instanceof Mark) {\n      return this._marks[instance.name]\n        ? this._marks[instance.name]\n        : Object.assign(this._marks, {\n            [instance.name]: instance\n          });\n    }\n  }\n\n  addProsemirrorSchema(nodes, type) {\n    this.prosemirrorSchema[type] = Object.assign(\n      this.prosemirrorSchema[type],\n      nodes\n    );\n  }\n\n  getSchema() {\n    const nodes = DefaultSchema.nodes;\n    const marks = {};\n\n    for (let index in this._nodes) {\n      nodes[index] = this._nodes[index].toJSON();\n    }\n\n    for (let index in this._marks) {\n      marks[index] = this._marks[index].toJSON();\n    }\n\n    this.schema = new PmPschema({\n      nodes: Object.assign(nodes, this.prosemirrorSchema.nodes),\n      marks: Object.assign(marks, this.prosemirrorSchema.marks)\n    });\n    return this.schema;\n  }\n}\n","import Service from \"../Service\";\nimport Schema from \"./Schema\";\nimport Node from \"./Node\";\nimport Mark from \"./Mark\";\n\nexport default class SchemaService extends Service {\n  name = \"SchemaService\";\n\n  register() {\n    this.container\n      .bind(\"Schema\")\n      .to(Schema)\n      .inSingletonScope();\n\n    this.container.bind(\"CreateNode\").toFactory(context => {\n      return (schema, options = { toWaxSchema: false }) => {\n        const schemaInstance = context.container.get(\"Schema\");\n        if (options.toWaxSchema) {\n          schemaInstance.addNode(schema);\n        } else {\n          schemaInstance.addProsemirrorSchema(schema, \"nodes\");\n        }\n      };\n    });\n\n    this.container.bind(\"CreateMark\").toFactory(context => {\n      return (schema, options = { toWaxSchema: false }) => {\n        const schemaInstance = context.container.get(\"Schema\");\n        if (options.toWaxSchema) {\n          schemaInstance.addMark(schema);\n        } else {\n          schemaInstance.addProsemirrorSchema(schema, \"marks\");\n        }\n      };\n    });\n  }\n}\n","import { injectable } from 'inversify';\nimport { keymap } from 'prosemirror-keymap';\nimport { undo, redo } from 'prosemirror-history';\n\nimport {\n  wrapInList,\n  splitListItem,\n  liftListItem,\n  sinkListItem,\n} from 'prosemirror-schema-list';\n\nimport {\n  baseKeymap,\n  chainCommands,\n  exitCode,\n  selectParentNode,\n  joinBackward,\n  selectNodeBackward,\n  deleteSelection,\n} from 'prosemirror-commands';\n\nconst backSpace = chainCommands(\n  deleteSelection,\n  joinBackward,\n  selectNodeBackward,\n);\n\nconst backSpaceShortCut = (state, dispatch, view) =>\n  backSpace(\n    state,\n    tr => dispatch(tr.setMeta('inputType', 'deleteContentBackward')),\n    view,\n  );\n\nconst undoShortCut = (state, dispatch, view) =>\n  undo(state, tr => dispatch(tr.setMeta('inputType', 'historyUndo')), view);\n\nconst redoShortCut = (state, dispatch, view) =>\n  redo(state, tr => dispatch(tr.setMeta('inputType', 'historyRedo')), view);\n\n@injectable()\nclass ShortCuts {\n  constructor(plugins, schema) {\n    this.insertBreak = this.insertBreak.bind(this);\n    this.insertRule = this.insertRule.bind(this);\n    this.PmPlugins = plugins;\n    this.schema = schema;\n    this.keys = this.getKeys();\n  }\n\n  insertBreak(state, dispatch) {\n    const br = this.schema.nodes.hard_break.create();\n    dispatch(state.tr.replaceSelectionWith(br).scrollIntoView());\n    return true;\n  }\n\n  insertRule(state, dispatch) {\n    const hr = this.schema.nodes.horizontal_rule.create();\n    dispatch(state.tr.replaceSelectionWith(hr).scrollIntoView());\n    return true;\n  }\n\n  createShortCuts() {\n    const shortCuts = keymap(this.createKeyBindings());\n    this.PmPlugins.add('shortcuts', shortCuts);\n  }\n\n  addShortCut(shortcut) {\n    Object.assign(this.keys, shortcut);\n    this.createShortCuts();\n  }\n\n  createKeyBindings() {\n    Object.keys(baseKeymap).forEach(key => {\n      if (this.keys[key]) {\n        this.keys[key] = chainCommands(this.keys[key], baseKeymap[key]);\n      } else {\n        this.keys[key] = baseKeymap[key];\n      }\n    });\n    return this.keys;\n  }\n\n  getKeys() {\n    return {\n      'Mod-z': undoShortCut,\n      'Shift-Mod-z': redoShortCut,\n      Backspace: backSpaceShortCut,\n      'Mod-y': redoShortCut,\n      Escape: selectParentNode,\n      'Mod-Enter': chainCommands(exitCode, this.insertBreak),\n      'Shift-Enter': chainCommands(exitCode, this.insertBreak),\n      'Ctrl-Enter': chainCommands(exitCode, this.insertBreak),\n      'Mod-_': this.insertRule,\n      'Mod-[': liftListItem(this.schema.nodes.list_item),\n      'Mod-]': sinkListItem(this.schema.nodes.list_item),\n      Enter: splitListItem(this.schema.nodes.list_item),\n      'Shift-Ctrl-8': wrapInList(this.schema.nodes.bulletlist),\n      'Shift-Ctrl-9': wrapInList(this.schema.nodes.orderedlist),\n    };\n  }\n}\n\nexport default ShortCuts;\n","import Service from \"../Service\";\nimport ShortCuts from \"./ShortCuts\";\n\nexport default class ShortCutsService extends Service {\n  name = \"ShortCutsService\";\n\n  boot() {\n    const shortCuts = this.container.get(\"ShortCuts\");\n    shortCuts.createShortCuts();\n  }\n\n  register() {\n    const PmPlugins = this.app.PmPlugins;\n    this.container\n      .bind(\"ShortCuts\")\n      .toDynamicValue(() => {\n        const { schema: { schema } } = this.app;\n\n        return new ShortCuts(PmPlugins, schema);\n      })\n      .inSingletonScope();\n  }\n}\n","import React from 'react';\nimport { injectable } from 'inversify';\nimport { isEmpty } from 'lodash';\nimport { v4 as uuidv4 } from 'uuid';\nimport { TrackChangeEnable } from 'wax-prosemirror-components';\nimport Tools from '../../lib/Tools';\n\nexport default\n@injectable()\nclass EnableTrackChange extends Tools {\n  title = 'Toggle Track Changes';\n  content = 'track changes';\n\n  get run() {\n    return state => {\n      this.config.enabled = !this.config.enabled;\n      return true;\n    };\n  }\n\n  get enable() {\n    return state => {\n      return true;\n    };\n  }\n\n  renderTool(view) {\n    if (isEmpty(view)) return null;\n    return this._isDisplayed ? (\n      <TrackChangeEnable\n        key={uuidv4()}\n        view={view}\n        item={this.toJSON()}\n        enabled={this.config.enabled}\n      />\n    ) : null;\n  }\n}\n","import Service from '../../Service';\nimport EnableTrackChange from './EnableTrackChange';\n\nclass EnableTrackChangeService extends Service {\n  name = 'EnableTrackChangeService';\n  boot() {}\n\n  register() {\n    this.container.bind('EnableTrackChange').toDynamicValue(() => {\n      return new EnableTrackChange(this.config);\n    });\n  }\n}\n\nexport default EnableTrackChangeService;\n","import { replaceStep } from 'prosemirror-transform';\nimport { Selection } from 'prosemirror-state';\n\nconst removeNode = (tr, node, nodePos, map) => {\n  const newNodePos = map.map(nodePos);\n  const selectionBefore = Selection.findFrom(tr.doc.resolve(newNodePos), -1);\n  const start = selectionBefore.$anchor.pos;\n  const end = newNodePos + 1;\n\n  const delStep = replaceStep(tr.doc, start, end);\n\n  tr.step(delStep);\n  const stepMap = delStep.getMap();\n  map.appendMap(stepMap);\n};\n\nexport default removeNode;\n","import { Mapping, RemoveMarkStep, ReplaceStep } from 'prosemirror-transform';\nimport { Slice } from 'prosemirror-model';\nimport { injectable } from 'inversify';\nimport removeNode from '../track-changes/helpers/removeNode';\nimport Tools from '../../lib/Tools';\n\nexport default\n@injectable()\nclass AcceptTrackChange extends Tools {\n  title = 'Accept Changes';\n  content = 'Accept';\n\n  get run() {\n    return (state, dispatch) => {\n      const {\n        tr,\n        selection: { from, to },\n      } = state;\n\n      tr.setMeta('AcceptReject', true);\n      const map = new Mapping();\n\n      state.doc.nodesBetween(from, to, (node, pos) => {\n        if (\n          node.attrs.track &&\n          node.attrs.track.find(track => track.type === 'deletion')\n        ) {\n          removeNode(tr, node, pos, map);\n        }\n        if (\n          node.marks &&\n          node.marks.find(mark => mark.type.name === 'deletion')\n        ) {\n          const deletionStep = new ReplaceStep(\n            map.map(Math.max(pos, from)),\n            map.map(Math.min(pos + node.nodeSize, to)),\n            Slice.empty,\n          );\n          tr.step(deletionStep);\n          map.appendMap(deletionStep.getMap());\n        } else if (\n          node.attrs.track &&\n          node.attrs.track.find(track => track.type === 'insertion')\n        ) {\n          const track = node.attrs.track.filter(\n            track => track.type !== 'insertion',\n          );\n          tr.setNodeMarkup(\n            map.map(pos),\n            null,\n            Object.assign(node.attrs.track, { track }),\n            node.marks,\n          );\n        } else if (\n          node.marks &&\n          node.marks.find(mark => mark.type.name === 'insertion')\n        ) {\n          const insertionMark = node.marks.find(\n            mark => mark.type.name === 'insertion',\n          );\n          tr.step(\n            new RemoveMarkStep(\n              map.map(Math.max(pos, from)),\n              map.map(Math.min(pos + node.nodeSize, to)),\n              insertionMark,\n            ),\n          );\n        } else if (\n          node.marks &&\n          node.marks.find(mark => mark.type.name === 'format_change')\n        ) {\n          const formatChangeMark = node.marks.find(\n            mark => mark.type.name === 'format_change',\n          );\n          tr.step(\n            new RemoveMarkStep(\n              map.map(Math.max(pos, from)),\n              map.map(Math.min(pos + node.nodeSize, to)),\n              formatChangeMark,\n            ),\n          );\n        } else if (\n          node.attrs.track &&\n          node.attrs.track.find(track => track.type === 'block_change')\n        ) {\n          const blockChangeTrack = node.attrs.track.find(\n            track => track.type === 'block_change',\n          );\n\n          const track = node.attrs.track.filter(\n            track => track !== blockChangeTrack,\n          );\n\n          tr.setNodeMarkup(\n            map.map(pos),\n            null,\n            Object.assign(node.attrs.track, { track }),\n            node.marks,\n          );\n        }\n      });\n      if (tr.steps.length) dispatch(tr);\n    };\n  }\n\n  select = (state, activeViewId) => {\n    const {\n      selection: { from, to },\n    } = state;\n    if (from === to && activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get active() {\n    return state => {};\n  }\n}\n","import Service from '../../Service';\nimport AcceptTrackChange from './AcceptTrackChange';\n\nclass AcceptTrackChangeService extends Service {\n  name = 'AcceptTrackChangeService';\n  // boot() {}\n\n  register() {\n    this.container.bind('AcceptTrackChange').to(AcceptTrackChange);\n  }\n}\n\nexport default AcceptTrackChangeService;\n","import {\n  Mapping,\n  RemoveMarkStep,\n  ReplaceStep,\n  AddMarkStep,\n} from 'prosemirror-transform';\nimport { Slice } from 'prosemirror-model';\nimport { injectable } from 'inversify';\nimport removeNode from '../track-changes/helpers/removeNode';\nimport Tools from '../../lib/Tools';\n\nexport default\n@injectable()\nclass RejectTrackChange extends Tools {\n  title = 'Reject Changes';\n  content = 'Reject';\n\n  get run() {\n    return (state, dispatch) => {\n      const {\n        tr,\n        selection: { from, to },\n      } = state;\n      tr.setMeta('AcceptReject', true);\n      const map = new Mapping();\n\n      state.doc.nodesBetween(from, to, (node, pos) => {\n        if (\n          node.marks &&\n          node.marks.find(mark => mark.type.name === 'deletion')\n        ) {\n          const deletionMark = node.marks.find(\n            mark => mark.type.name === 'deletion',\n          );\n          tr.step(\n            new RemoveMarkStep(\n              map.map(Math.max(pos, from)),\n              map.map(Math.min(pos + node.nodeSize, to)),\n              deletionMark,\n            ),\n          );\n        } else if (\n          node.attrs.track &&\n          node.attrs.track.find(track => track.type === 'insertion')\n        ) {\n          removeNode(tr, node, pos, map);\n        } else if (\n          node.marks &&\n          node.marks.find(mark => mark.type.name === 'insertion')\n        ) {\n          const deletionStep = new ReplaceStep(\n            map.map(Math.max(pos, from)),\n            map.map(Math.min(pos + node.nodeSize, to)),\n            Slice.empty,\n          );\n          tr.step(deletionStep);\n          map.appendMap(deletionStep.getMap());\n        } else if (\n          node.marks &&\n          node.marks.find(mark => mark.type.name === 'format_change')\n        ) {\n          const formatChangeMark = node.marks.find(\n            mark => mark.type.name === 'format_change',\n          );\n          formatChangeMark.attrs.before.forEach(oldMark => {\n            tr.step(\n              new AddMarkStep(\n                map.map(Math.max(pos, from)),\n                map.map(Math.min(pos + node.nodeSize, to)),\n                state.schema.marks[oldMark].create(),\n              ),\n            );\n          });\n          formatChangeMark.attrs.after.forEach(newMark => {\n            tr.step(\n              new RemoveMarkStep(\n                map.map(Math.max(pos, from)),\n                map.map(Math.min(pos + node.nodeSize, to)),\n                node.marks.find(mark => mark.type.name === newMark),\n              ),\n            );\n          });\n\n          tr.step(\n            new RemoveMarkStep(\n              map.map(Math.max(pos, from)),\n              map.map(Math.min(pos + node.nodeSize, to)),\n              formatChangeMark,\n            ),\n          );\n        }\n      });\n      if (tr.steps.length) dispatch(tr);\n    };\n  }\n\n  select = (state, activeViewId) => {\n    const {\n      selection: { from, to },\n    } = state;\n    if (from === to && activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get active() {\n    return state => {};\n  }\n}\n","import Service from '../../Service';\nimport RejectTrackChange from './RejectTrackChange';\n\nclass RejectTrackChangeService extends Service {\n  name = 'RejectTrackChangeService';\n  boot() {}\n\n  register() {\n    this.container.bind('RejectTrackChange').to(RejectTrackChange);\n  }\n}\n\nexport default RejectTrackChangeService;\n","import EnableTrackChangeService from './EnableTrackChangeService/EnableTrackChangeService';\nimport AcceptTrackChangeService from './AcceptTrackChangeService/AcceptTrackChangeService';\nimport RejectTrackChangeService from './RejectTrackChangeService/RejectTrackChangeService';\n\nexport default [\n  new EnableTrackChangeService(),\n  new AcceptTrackChangeService(),\n  new RejectTrackChangeService(),\n];\n","import { trackChangesMarks, trackChangesNodes } from 'wax-prosemirror-schema';\nimport Service from '../Service';\nimport TrackChangeServices from './index';\n\nclass TrackChangeService extends Service {\n  boot() {}\n\n  register() {\n    const createMark = this.container.get('CreateMark');\n    const createNode = this.container.get('CreateNode');\n\n    Object.keys(trackChangesMarks).forEach(mark => {\n      createMark(\n        {\n          [mark]: trackChangesMarks[mark],\n        },\n        { toWaxSchema: true },\n      );\n    });\n\n    Object.keys(trackChangesNodes).forEach(node => {\n      createNode(\n        {\n          [node]: trackChangesNodes[node],\n        },\n        { toWaxSchema: true },\n      );\n    });\n  }\n\n  dependencies = TrackChangeServices;\n}\n\nexport default TrackChangeService;\n","import { Selection, TextSelection } from 'prosemirror-state';\nimport { Slice } from 'prosemirror-model';\nimport { ReplaceStep, Mapping } from 'prosemirror-transform';\n\nconst markDeletion = (tr, from, to, user, date, group) => {\n  const deletionMark = tr.doc.type.schema.marks.deletion.create({\n    user: user.userId,\n    username: user.username,\n    // date\n  });\n\n  const deletionMap = new Mapping();\n\n  tr.doc.nodesBetween(from, to, (node, pos) => {\n    if (node.type.name.includes('table')) {\n      return;\n    }\n    if (\n      node.isInline &&\n      node.marks.find(\n        mark =>\n          mark.type.name === 'insertion' && mark.attrs.user === user.userId,\n      )\n    ) {\n      const removeStep = new ReplaceStep(\n        deletionMap.map(Math.max(from, pos)),\n        deletionMap.map(Math.min(to, pos + node.nodeSize)),\n        Slice.empty,\n      );\n      if (!tr.maybeStep(removeStep).failed) {\n        deletionMap.appendMap(removeStep.getMap());\n      }\n    } else if (\n      node.isInline &&\n      !node.marks.find(mark => mark.type.name === 'deletion')\n    ) {\n      tr.addMark(\n        deletionMap.map(Math.max(from, pos)),\n        deletionMap.map(Math.min(to, pos + node.nodeSize)),\n        deletionMark,\n      );\n    } else if (\n      node.attrs.track &&\n      !node.attrs.track.find(trackAttr => trackAttr.type === 'deletion') &&\n      !['bullet_list', 'ordered_list'].includes(node.type.name)\n    ) {\n      if (\n        node.attrs.track.find(\n          trackAttr =>\n            trackAttr.type === 'insertion' && trackAttr.user === user.userId,\n        )\n      ) {\n        let removeStep;\n        if (node.isTextblock && to < pos + node.nodeSize) {\n          const selectionBefore = Selection.findFrom(tr.doc.resolve(pos), -1);\n          if (selectionBefore instanceof TextSelection) {\n            removeStep = new ReplaceStep(\n              deletionMap.map(selectionBefore.$anchor.pos),\n              deletionMap.map(to),\n              Slice.empty,\n            );\n          }\n        } else {\n          removeStep = new ReplaceStep(\n            deletionMap.map(Math.max(from, pos)),\n            deletionMap.map(Math.min(to, pos + node.nodeSize)),\n            Slice.empty,\n          );\n        }\n\n        if (!tr.maybeStep(removeStep).failed) {\n          deletionMap.appendMap(removeStep.getMap());\n        }\n      }\n\n      let counter = 2;\n      node.content.forEach((item, i) => {\n        item.marks.forEach(mark => {\n          if (mark.type.name === 'deletion') {\n            counter += item.nodeSize;\n          }\n        });\n      });\n\n      if (node.content.size === 0 || counter === node.nodeSize) {\n        const track = node.attrs.track.slice();\n        track.push({\n          type: 'deletion',\n          user: user.userId,\n          username: user.username,\n          // date\n        });\n        tr.setNodeMarkup(\n          deletionMap.map(pos),\n          null,\n          Object.assign(node.attrs.track, { track }),\n          node.marks,\n        );\n      }\n    }\n  });\n\n  return deletionMap;\n};\n\nexport default markDeletion;\n","import { v4 as uuidv4 } from \"uuid\";\n\nconst markInsertion = (tr, from, to, user, date, group) => {\n  tr.removeMark(from, to, tr.doc.type.schema.marks.deletion);\n  tr.removeMark(from, to, tr.doc.type.schema.marks.insertion);\n\n  const insertionMark = tr.doc.type.schema.marks.insertion.create({\n    user: user.userId,\n    username: user.username\n    // date\n  });\n\n  tr.addMark(from, to, insertionMark);\n  // Add insertion mark also to block nodes (figures, text blocks) but not table cells/rows and lists.\n  tr.doc.nodesBetween(from, to, (node, pos) => {\n    if (\n      pos < from ||\n      [\"bullet_list\", \"ordered_list\"].includes(node.type.name)\n    ) {\n      return true;\n    } else if (\n      node.isInline ||\n      [\"table_row\", \"table_cell\"].includes(node.type.name)\n    ) {\n      return false;\n    }\n    if (node.attrs.track) {\n      const track = [];\n\n      track.push({\n        type: \"insertion\",\n        user: user.userId,\n        username: user.username,\n        date,\n        group\n      });\n\n      tr.setNodeMarkup(\n        pos,\n        null,\n        Object.assign({}, node.attrs, { track, group, id: uuidv4() }),\n        node.marks\n      );\n    }\n    if (node.type.name === \"table\") {\n      // A table was inserted. We don't add track marks to elements inside of it.\n      return false;\n    }\n  });\n};\n\nexport default markInsertion;\n","import { ReplaceStep } from \"prosemirror-transform\";\nimport { CellSelection } from \"prosemirror-tables\";\nimport { DocumentHelpers } from \"wax-prosemirror-utilities\";\n\nimport markDeletion from \"./markDeletion\";\nimport markInsertion from \"./markInsertion\";\n\nconst replaceStep = (state, tr, step, newTr, map, doc, user, date, group) => {\n  const cellDeleteTr =\n    [\"deleteContentBackward\", \"deleteContentForward\"].includes(\n      tr.getMeta(\"inputType\")\n    ) && state.selection instanceof CellSelection;\n\n  // if deletion mark move to the end of deletion\n  const deletionMarkSchema = state.schema.marks.deletion;\n  const deletionMark = DocumentHelpers.findMark(\n    state,\n    deletionMarkSchema,\n    false\n  );\n  const positionTo = deletionMark ? deletionMark.to : step.to;\n\n  const newStep = !cellDeleteTr\n    ? new ReplaceStep(\n        positionTo, // We insert all the same steps, but with \"from\"/\"to\" both set to \"to\" in order not to delete content. Mapped as needed.\n        positionTo,\n        step.slice,\n        step.structure\n      )\n    : false;\n\n  // We didn't apply the original step in its original place. We adjust the map accordingly.\n  map.appendMap(step.invert(doc).getMap());\n  if (newStep) {\n    const trTemp = state.apply(newTr).tr;\n    if (trTemp.maybeStep(newStep).failed) {\n      return;\n    }\n    const mappedNewStepTo = newStep.getMap().map(newStep.to);\n\n    markInsertion(trTemp, newStep.from, mappedNewStepTo, user, date, group);\n    // We condense it down to a single replace step.\n    const condensedStep = new ReplaceStep(\n      newStep.from,\n      newStep.to,\n      trTemp.doc.slice(newStep.from, mappedNewStepTo)\n    );\n\n    newTr.step(condensedStep);\n    const mirrorIndex = map.maps.length - 1;\n    map.appendMap(condensedStep.getMap(), mirrorIndex);\n    if (!newTr.selection.eq(trTemp.selection)) {\n      newTr.setSelection(trTemp.selection);\n    }\n  }\n  if (step.from !== step.to) {\n    map.appendMap(markDeletion(newTr, step.from, step.to, user, date, group));\n  }\n};\n\nexport default replaceStep;\n","import { v4 as uuidv4 } from 'uuid';\n\nconst markWrapping = (tr, pos, oldNode, newNode, user, date, group) => {\n  let track = oldNode.attrs.track.slice();\n  let blockTrack = track.find(track => track.type === 'block_change');\n\n  if (blockTrack) {\n    track = track.filter(track => track !== blockTrack);\n    if (\n      blockTrack.before.type !== newNode.type.name ||\n      blockTrack.before.attrs.level !== newNode.attrs.level\n    ) {\n      blockTrack = {\n        type: 'block_change',\n        user: user.userId,\n        username: user.username,\n        date,\n        before: blockTrack.before,\n      };\n      track.push(blockTrack);\n    }\n  } else {\n    blockTrack = {\n      type: 'block_change',\n      user: user.userId,\n      username: user.username,\n      date,\n      before: { type: oldNode.type.name, attrs: oldNode.attrs },\n    };\n    if (blockTrack.before.attrs.id) {\n      delete blockTrack.before.attrs.id;\n    }\n    if (blockTrack.before.attrs.track) {\n      delete blockTrack.before.attrs.track;\n    }\n    track.push(blockTrack);\n  }\n  tr.setNodeMarkup(\n    pos,\n    null,\n    Object.assign({}, newNode.attrs, { track, group, id: uuidv4() }),\n  );\n};\n\nexport default markWrapping;\n","import markDeletion from \"./markDeletion\";\nimport markInsertion from \"./markInsertion\";\nimport markWrapping from \"./markWrapping\";\n\nconst replaceAroundStep = (\n  state,\n  tr,\n  step,\n  newTr,\n  map,\n  doc,\n  user,\n  date,\n  group\n) => {\n  if (step.from === step.gapFrom && step.to === step.gapTo) {\n    // wrapped in something\n    newTr.step(step);\n    const from = step.getMap().map(step.from, -1);\n    const to = step.getMap().map(step.gapFrom);\n    markInsertion(newTr, from, to, user, date, group);\n  } else if (!step.slice.size) {\n    // unwrapped from something\n    map.appendMap(step.invert(doc).getMap());\n    map.appendMap(\n      markDeletion(newTr, step.from, step.gapFrom, user, date, group)\n    );\n  } else if (\n    step.slice.size === 2 &&\n    step.gapFrom - step.from === 1 &&\n    step.to - step.gapTo === 1\n  ) {\n    // Replaced one wrapping with another\n    newTr.step(step);\n    const oldNode = doc.nodeAt(step.from);\n    if (oldNode.attrs.track) {\n      markWrapping(\n        newTr,\n        step.from,\n        oldNode,\n        step.slice.content.firstChild,\n        user,\n        date,\n        group\n      );\n    }\n  } else {\n    console.log(\"to fix\");\n    // newTr.step(step);\n    // const ranges = [\n    //   {\n    //     from: step.getMap().map(step.from, -1),\n    //     to: step.getMap().map(step.gapFrom)\n    //   },\n    //   {\n    //     from: step.getMap().map(step.gapTo, -1),\n    //     to: step.getMap().map(step.to)\n    //   }\n    // ];\n    // ranges.forEach(range =>\n    //   doc.nodesBetween(range.from, range.to, (node, pos) => {\n    //     if (pos < range.from) {\n    //       return true;\n    //     }\n    //     markInsertion(newTr, range.from, range.to, user, date);\n    //   })\n    // );\n  }\n};\n\nexport default replaceAroundStep;\n","import { v4 as uuidv4 } from 'uuid';\n\nconst addMarkStep = (state, tr, step, newTr, map, doc, user, date, group) => {\n  doc.nodesBetween(step.from, step.to, (node, pos) => {\n    if (!node.isInline) {\n      return true;\n    }\n    if (node.marks.find(mark => mark.type.name === 'deletion')) {\n      return false;\n    }\n    newTr.addMark(\n      Math.max(step.from, pos),\n      Math.min(step.to, pos + node.nodeSize),\n      step.mark,\n    );\n\n    if (\n      !['comment'].includes(step.mark.type.name) &&\n      !node.marks.find(mark => mark.type === step.mark.type)\n    ) {\n      const formatChangeMark = node.marks.find(\n        mark => mark.type.name === 'format_change',\n      );\n      let after, before;\n      if (formatChangeMark) {\n        if (formatChangeMark.attrs.before.includes(step.mark.type.name)) {\n          before = formatChangeMark.attrs.before.filter(\n            markName => markName !== step.mark.type.name,\n          );\n          after = formatChangeMark.attrs.after;\n        } else {\n          before = formatChangeMark.attrs.before;\n          after = formatChangeMark.attrs.after.concat(step.mark.type.name);\n        }\n      } else {\n        before = [];\n        after = [step.mark.type.name];\n      }\n      if (after.length || before.length) {\n        // Math.max(step.from, pos),\n        // Math.min(step.to, pos + node.nodeSize),\n        newTr.addMark(\n          step.from,\n          step.to,\n          state.schema.marks.format_change.create({\n            user: user.userId,\n            username: user.username,\n            date,\n            before,\n            after,\n            group,\n            id: uuidv4(),\n          }),\n        );\n      } else if (formatChangeMark) {\n        newTr.removeMark(\n          Math.max(step.from, pos),\n          Math.min(step.to, pos + node.nodeSize),\n          formatChangeMark,\n        );\n      }\n    }\n  });\n};\n\nexport default addMarkStep;\n","const removeMarkStep = (state, tr, step, newTr, map, doc, user, date) => {\n  doc.nodesBetween(step.from, step.to, (node, pos) => {\n    if (!node.isInline) {\n      return true;\n    }\n    if (node.marks.find(mark => mark.type.name === 'deletion')) {\n      return false;\n    }\n    newTr.removeMark(\n      Math.max(step.from, pos),\n      Math.min(step.to, pos + node.nodeSize),\n      step.mark,\n    );\n\n    if (\n      ['em', 'strong', 'underline'].includes(step.mark.type.name) &&\n      node.marks.find(mark => mark.type === step.mark.type)\n    ) {\n      const formatChangeMark = node.marks.find(\n        mark => mark.type.name === 'format_change',\n      );\n      let after, before;\n      if (formatChangeMark) {\n        if (formatChangeMark.attrs.after.includes(step.mark.type.name)) {\n          after = formatChangeMark.attrs.after.filter(\n            markName => markName !== step.mark.type.name,\n          );\n          before = formatChangeMark.attrs.before;\n        } else {\n          after = formatChangeMark.attrs.after;\n          before = formatChangeMark.attrs.before.concat(step.mark.type.name);\n        }\n      } else {\n        after = [];\n        before = [step.mark.type.name];\n      }\n      if (after.length || before.length) {\n        newTr.addMark(\n          Math.max(step.from, pos),\n          Math.min(step.to, pos + node.nodeSize),\n          state.schema.marks.format_change.create({\n            user: user.userId,\n            username: user.username,\n            date,\n            before,\n            after,\n          }),\n        );\n      } else if (formatChangeMark) {\n        newTr.removeMark(\n          Math.max(step.from, pos),\n          Math.min(step.to, pos + node.nodeSize),\n          formatChangeMark,\n        );\n      }\n    }\n  });\n};\n\nexport default removeMarkStep;\n","/*\nThis belongs to https://github.com/fiduswriter/fiduswriter\ncheck: https://github.com/fiduswriter/fiduswriter/blob/develop/fiduswriter/document/static/js/modules/editor/track/amend_transaction.js\nLicense included in folder.\n*/\n\nimport { TextSelection } from 'prosemirror-state';\nimport {\n  ReplaceStep,\n  ReplaceAroundStep,\n  AddMarkStep,\n  RemoveMarkStep,\n  Mapping,\n} from 'prosemirror-transform';\n\nimport { DocumentHelpers } from 'wax-prosemirror-utilities';\nimport replaceStep from './helpers/replaceStep';\nimport replaceAroundStep from './helpers/replaceAroundStep';\nimport addMarkStep from './helpers/addMarkStep';\nimport removeMarkStep from './helpers/removeMarkStep';\n\nconst trackedTransaction = (tr, state, user) => {\n  if (\n    !tr.steps.length ||\n    (tr.meta &&\n      !Object.keys(tr.meta).every(metadata =>\n        ['inputType', 'uiEvent', 'paste', 'outsideView'].includes(metadata),\n      )) ||\n    ['historyUndo', 'historyRedo', 'AcceptReject'].includes(\n      tr.getMeta('inputType'),\n    )\n  ) {\n    return tr;\n  }\n\n  const group = tr.getMeta('outsideView') ? tr.getMeta('outsideView') : 'main';\n  const newTr = state.tr;\n  const map = new Mapping();\n  const date = Math.floor(Date.now() / 300000);\n\n  tr.steps.forEach(originalStep => {\n    const step = originalStep.map(map);\n    const { doc } = newTr;\n    if (!step) {\n      return;\n    }\n\n    switch (step.constructor) {\n      case ReplaceStep:\n        replaceStep(state, tr, step, newTr, map, doc, user, date, group);\n        break;\n      case ReplaceAroundStep:\n        replaceAroundStep(state, tr, step, newTr, map, doc, user, date, group);\n        break;\n      case AddMarkStep:\n        addMarkStep(state, tr, step, newTr, map, doc, user, date, group);\n        break;\n      case RemoveMarkStep:\n        removeMarkStep(state, tr, step, newTr, map, doc, user, date, group);\n        break;\n      default:\n    }\n  });\n\n  if (tr.getMeta('inputType')) newTr.setMeta(tr.getMeta('inputType'));\n\n  if (tr.getMeta('uiEvent')) newTr.setMeta(tr.getMeta('uiEvent'));\n\n  if (tr.selectionSet) {\n    const deletionMarkSchema = state.schema.marks.deletion;\n    const deletionMark = DocumentHelpers.findMark(\n      state,\n      deletionMarkSchema,\n      false,\n    );\n\n    if (\n      tr.selection instanceof TextSelection &&\n      (tr.selection.from < state.selection.from ||\n        tr.getMeta('inputType') === 'deleteContentBackward')\n    ) {\n      const caretPos = map.map(tr.selection.from, -1);\n      newTr.setSelection(new TextSelection(newTr.doc.resolve(caretPos)));\n    } else if (tr.selection.from > state.selection.from && deletionMark) {\n      const caretPos = map.map(deletionMark.to + 1, 1);\n      newTr.setSelection(new TextSelection(newTr.doc.resolve(caretPos)));\n    } else {\n      newTr.setSelection(tr.selection.map(newTr.doc, map));\n    }\n  }\n\n  if (\n    state.selection.from - tr.selection.from > 1 &&\n    tr.selection.$head.depth > 1\n  ) {\n    const caretPos = map.map(tr.selection.from - 2, -1);\n    newTr.setSelection(new TextSelection(newTr.doc.resolve(caretPos)));\n  } else {\n    const caretPos = map.map(tr.selection.from, -1);\n    newTr.setSelection(new TextSelection(newTr.doc.resolve(caretPos)));\n    // const slice = map.slice(newTr.selection.from, newTr.selection.to);\n    // map.appendMap(slice);\n  }\n\n  if (tr.storedMarksSet) newTr.setStoredMarks(tr.storedMarks);\n\n  if (tr.scrolledIntoView) newTr.scrollIntoView();\n\n  return newTr;\n};\n\nexport default trackedTransaction;\n","import { undo } from 'prosemirror-history';\nimport { injectable } from 'inversify';\nimport { icons } from 'wax-prosemirror-components';\nimport Tools from '../../lib/Tools';\n\nexport default\n@injectable()\nclass Undo extends Tools {\n  title = 'Undo last change';\n  content = icons.undo;\n  onlyOnMain = true;\n\n  get run() {\n    return (state, dispatch) => {\n      undo(state, tr => dispatch(tr.setMeta('inputType', 'historyUndo')));\n    };\n  }\n\n  get enable() {\n    return undo;\n  }\n}\n","import Service from \"../../Service\";\nimport Undo from \"./Undo\";\n\nclass UndoService extends Service {\n  boot() {}\n\n  register() {\n    this.container.bind(\"Undo\").to(Undo);\n  }\n}\n\nexport default UndoService;\n","import { redo } from 'prosemirror-history';\nimport Tools from '../../lib/Tools';\nimport { injectable } from 'inversify';\nimport { icons } from 'wax-prosemirror-components';\n\nexport default\n@injectable()\nclass Redo extends Tools {\n  title = 'Redo last undone change';\n  content = icons.redo;\n  onlyOnMain = true;\n\n  get run() {\n    return (state, dispatch) => {\n      redo(state, tr => dispatch(tr.setMeta('inputType', 'historyRedo')));\n    };\n  }\n\n  get enable() {\n    return redo;\n  }\n}\n","import Service from '../../Service';\nimport Redo from './Redo';\n\nclass RedoService extends Service {\n  // boot() {}\n\n  register() {\n    this.container.bind('Redo').to(Redo);\n  }\n}\n\nexport default RedoService;\n","import Tools from \"../../lib/Tools\";\nimport { injectable } from \"inversify\";\nimport { icons } from \"wax-prosemirror-components\";\n\n@injectable()\nexport default class Save extends Tools {\n  title = \"Save changes\";\n  content = icons.save;\n\n  get run() {}\n\n  get enable() {}\n}\n","import UndoService from \"./UndoService/UndoService\";\nimport RedoService from \"./RedoService/RedoService\";\nimport SaveService from \"./SaveService/SaveService\";\n\nexport default [new UndoService(), new RedoService()];\n","import Service from \"../Service\";\nimport BaseServices from \"./index\";\n\nclass BaseService extends Service {\n  dependencies = BaseServices;\n}\n\nexport default BaseService;\n","import { toggleMark } from 'prosemirror-commands';\nimport { Commands } from 'wax-prosemirror-utilities';\nimport Tools from '../../lib/Tools';\nimport { injectable } from 'inversify';\nimport { icons } from 'wax-prosemirror-components';\n\nexport default\n@injectable()\nclass Code extends Tools {\n  title = 'Toggle code';\n  content = icons.code;\n\n  get run() {\n    return (state, dispatch) => {\n      toggleMark(state.config.schema.marks.code)(state, dispatch);\n    };\n  }\n\n  get active() {\n    return state => {\n      return Commands.markActive(state.config.schema.marks.code)(state);\n    };\n  }\n}\n","import { toggleMark } from 'prosemirror-commands';\nimport { codeMark } from 'wax-prosemirror-schema';\nimport Code from './Code';\nimport Service from '../../Service';\n\nclass CodeService extends Service {\n  boot() {\n    const shortCuts = this.container.get('ShortCuts');\n    shortCuts.addShortCut({ 'Mod-`': toggleMark(this.schema.marks.code) });\n  }\n\n  register() {\n    this.container.bind('Code').to(Code);\n    const createMark = this.container.get('CreateMark');\n    createMark(\n      {\n        code: codeMark,\n      },\n      { toWaxSchema: true },\n    );\n  }\n}\n\nexport default CodeService;\n","import { toggleMark } from \"prosemirror-commands\";\nimport { Commands } from \"wax-prosemirror-utilities\";\nimport Tools from \"../../lib/Tools\";\nimport { injectable } from \"inversify\";\nimport { icons } from \"wax-prosemirror-components\";\n\n@injectable()\nexport default class Strong extends Tools {\n  title = \"Toggle strong\";\n  content = icons.strong;\n\n  get run() {\n    return (state, dispatch) => {\n      toggleMark(state.config.schema.marks.strong)(state, dispatch);\n    };\n  }\n\n  get active() {\n    return state => {\n      return Commands.markActive(state.config.schema.marks.strong)(state);\n    };\n  }\n}\n","import Service from \"../../Service\";\nimport { toggleMark } from \"prosemirror-commands\";\nimport { strongMark } from \"wax-prosemirror-schema\";\nimport Strong from \"./Strong\";\n\nclass StrongService extends Service {\n  boot() {\n    const shortCuts = this.container.get(\"ShortCuts\");\n    shortCuts.addShortCut({ \"Mod-b\": toggleMark(this.schema.marks.strong) });\n  }\n\n  register() {\n    this.container.bind(\"Strong\").to(Strong);\n    const createMark = this.container.get(\"CreateMark\");\n    createMark(\n      {\n        strong: strongMark\n      },\n      { toWaxSchema: true }\n    );\n  }\n}\n\nexport default StrongService;\n","import { toggleMark } from 'prosemirror-commands';\nimport { Commands } from 'wax-prosemirror-utilities';\nimport Tools from '../../lib/Tools';\nimport { injectable } from 'inversify';\nimport { icons } from 'wax-prosemirror-components';\n\nexport default\n@injectable()\nclass Emphasis extends Tools {\n  title = 'Toggle emphasis';\n  content = icons.em;\n\n  get run() {\n    return (state, dispatch) => {\n      toggleMark(state.config.schema.marks.em)(state, dispatch);\n    };\n  }\n\n  get active() {\n    return state => {\n      return Commands.markActive(state.config.schema.marks.em)(state);\n    };\n  }\n}\n","import { toggleMark } from 'prosemirror-commands';\nimport { emphasisMark } from 'wax-prosemirror-schema';\nimport Emphasis from './Emphasis';\nimport Service from '../../Service';\n\nclass EmphasisService extends Service {\n  boot() {\n    const shortCuts = this.container.get('ShortCuts');\n    shortCuts.addShortCut({ 'Mod-i': toggleMark(this.schema.marks.em) });\n  }\n\n  register() {\n    this.container.bind('Emphasis').to(Emphasis);\n    const createMark = this.container.get('CreateMark');\n    createMark(\n      {\n        em: emphasisMark,\n      },\n      { toWaxSchema: true },\n    );\n  }\n}\n\nexport default EmphasisService;\n","import { toggleMark } from \"prosemirror-commands\";\nimport { Commands } from \"wax-prosemirror-utilities\";\nimport Tools from \"../../lib/Tools\";\nimport { injectable } from \"inversify\";\nimport { icons } from \"wax-prosemirror-components\";\n\n@injectable()\nexport default class Subscript extends Tools {\n  title = \"Toggle subscript\";\n  content = icons.subscript;\n\n  get run() {\n    return (state, dispatch) => {\n      toggleMark(state.config.schema.marks.subscript)(state, dispatch);\n    };\n  }\n\n  get active() {\n    return state => {\n      return Commands.markActive(state.config.schema.marks.subscript)(state);\n    };\n  }\n}\n","import Service from \"../../Service\";\nimport { subscriptMark } from \"wax-prosemirror-schema\";\nimport Subscript from \"./Subscript\";\n\nclass SubscriptService extends Service {\n  boot() {}\n\n  register() {\n    this.container.bind(\"Subscript\").to(Subscript);\n    const createMark = this.container.get(\"CreateMark\");\n    createMark(\n      {\n        subscript: subscriptMark\n      },\n      { toWaxSchema: true }\n    );\n  }\n}\n\nexport default SubscriptService;\n","import { toggleMark } from \"prosemirror-commands\";\nimport { Commands } from \"wax-prosemirror-utilities\";\nimport Tools from \"../../lib/Tools\";\nimport { injectable } from \"inversify\";\nimport { icons } from \"wax-prosemirror-components\";\n\n@injectable()\nexport default class Superscript extends Tools {\n  title = \"Toggle superscript\";\n  content = icons.superscript;\n\n  get run() {\n    return (state, dispatch) => {\n      toggleMark(state.config.schema.marks.superscript)(state, dispatch);\n    };\n  }\n\n  get active() {\n    return state => {\n      return Commands.markActive(state.config.schema.marks.superscript)(state);\n    };\n  }\n}\n","import Service from \"../../Service\";\nimport { superscriptMark } from \"wax-prosemirror-schema\";\nimport Superscript from \"./Superscript\";\n\nclass SuperscriptService extends Service {\n  boot() {}\n\n  register() {\n    this.container.bind(\"Superscript\").to(Superscript);\n    const createMark = this.container.get(\"CreateMark\");\n    createMark(\n      {\n        superscript: superscriptMark\n      },\n      { toWaxSchema: true }\n    );\n  }\n}\n\nexport default SuperscriptService;\n","import { toggleMark } from \"prosemirror-commands\";\nimport { Commands } from \"wax-prosemirror-utilities\";\nimport Tools from \"../../lib/Tools\";\nimport { injectable } from \"inversify\";\nimport { icons } from \"wax-prosemirror-components\";\n\n@injectable()\nexport default class StrikeThrough extends Tools {\n  title = \"Toggle strikethrough\";\n  content = icons.strikethrough;\n\n  get run() {\n    return (state, dispatch) => {\n      toggleMark(state.config.schema.marks.strikethrough)(state, dispatch);\n    };\n  }\n\n  get active() {\n    return state => {\n      return Commands.markActive(state.config.schema.marks.strikethrough)(\n        state\n      );\n    };\n  }\n}\n","import Service from \"../../Service\";\nimport { strikethroughMark } from \"wax-prosemirror-schema\";\nimport StrikeThrough from \"./StrikeThrough\";\nclass StrikeThroughService extends Service {\n  register() {\n    this.container.bind(\"StrikeThrough\").to(StrikeThrough);\n    const createMark = this.container.get(\"CreateMark\");\n    createMark(\n      {\n        strikethrough: strikethroughMark\n      },\n      { toWaxSchema: true }\n    );\n  }\n}\n\nexport default StrikeThroughService;\n","import { toggleMark } from \"prosemirror-commands\";\nimport { Commands } from \"wax-prosemirror-utilities\";\nimport Tools from \"../../lib/Tools\";\nimport { injectable } from \"inversify\";\nimport { icons } from \"wax-prosemirror-components\";\n\n@injectable()\nexport default class Underline extends Tools {\n  title = \"Toggle underline\";\n  content = icons.underline;\n\n  get run() {\n    return (state, dispatch) => {\n      toggleMark(state.config.schema.marks.underline)(state, dispatch);\n    };\n  }\n\n  get active() {\n    return state => {\n      return Commands.markActive(state.config.schema.marks.underline)(state);\n    };\n  }\n}\n","import Service from \"../../Service\";\nimport { toggleMark } from \"prosemirror-commands\";\nimport { underlineMark } from \"wax-prosemirror-schema\";\nimport Underline from \"./Underline\";\n\nclass UnderlineService extends Service {\n  boot() {\n    const shortCuts = this.container.get(\"ShortCuts\");\n    shortCuts.addShortCut({ \"Mod-u\": toggleMark(this.schema.marks.underline) });\n  }\n\n  register() {\n    this.container.bind(\"Underline\").to(Underline);\n    const createMark = this.container.get(\"CreateMark\");\n    createMark(\n      {\n        underline: underlineMark\n      },\n      { toWaxSchema: true }\n    );\n  }\n}\n\nexport default UnderlineService;\n","import { toggleMark } from \"prosemirror-commands\";\nimport { Commands } from \"wax-prosemirror-utilities\";\nimport Tools from \"../../lib/Tools\";\nimport { injectable } from \"inversify\";\nimport { icons } from \"wax-prosemirror-components\";\n\n@injectable()\nexport default class SmallCaps extends Tools {\n  title = \"Toggle Small Caps\";\n  content = icons.small_caps;\n\n  get run() {\n    return (state, dispatch) => {\n      toggleMark(state.config.schema.marks.smallcaps)(state, dispatch);\n    };\n  }\n\n  get active() {\n    return state => {\n      return Commands.markActive(state.config.schema.marks.smallcaps)(state);\n    };\n  }\n}\n","import Service from \"../../Service\";\nimport { smallcapsMark } from \"wax-prosemirror-schema\";\nimport SmallCaps from \"./SmallCaps\";\n\nclass SmallCapsService extends Service {\n  register() {\n    this.container.bind(\"SmallCaps\").to(SmallCaps);\n    const createMark = this.container.get(\"CreateMark\");\n    createMark(\n      {\n        smallcaps: smallcapsMark\n      },\n      { toWaxSchema: true }\n    );\n  }\n}\n\nexport default SmallCapsService;\n","import CodeService from \"./CodeService/CodeService\";\nimport StrongService from \"./StrongService/StrongService\";\nimport EmphasisService from \"./EmphasisService/EmphasisService\";\nimport SubscriptService from \"./SubscriptService/SubscriptService\";\nimport SuperscriptService from \"./SuperscriptService/SuperscriptService\";\nimport StrikeThroughService from \"./StrikeThroughService/StrikeThroughService\";\nimport UnderlineService from \"./UnderlineService/UnderlineService\";\nimport SmallCapsService from \"./SmallCapsService/SmallCapsService\";\n\nexport default [\n  new CodeService(),\n  new StrongService(),\n  new EmphasisService(),\n  new SubscriptService(),\n  new SuperscriptService(),\n  new StrikeThroughService(),\n  new UnderlineService(),\n  new SmallCapsService()\n];\n","import Service from \"../Service\";\nimport InlineServices from \"./index\";\n\nclass InlineAnnotationsService extends Service {\n  dependencies = InlineServices;\n}\n\nexport default InlineAnnotationsService;\n","import Tools from '../../lib/Tools';\nimport { injectable } from 'inversify';\nimport { icons } from 'wax-prosemirror-components';\nimport { wrapInList } from 'prosemirror-schema-list';\nimport { Commands } from 'wax-prosemirror-utilities';\n\n@injectable()\nexport default class BulletList extends Tools {\n  title = 'Wrap in bullet list';\n  content = icons.bullet_list;\n\n  get run() {\n    return (state, dispatch) => {\n      return wrapInList(state.config.schema.nodes.bulletlist)(state, dispatch);\n    };\n  }\n\n  get enable() {\n    return state => {\n      return wrapInList(state.config.schema.nodes.bulletlist)(state);\n    };\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get active() {\n    return state => {\n      return Commands.blockActive(state.config.schema.nodes.bulletlist)(state);\n    };\n  }\n}\n","// import { wrapInList } from 'prosemirror-schema-list';\nimport { bulletListNode } from 'wax-prosemirror-schema';\nimport Service from '../../Service';\nimport BulletList from './BulletList';\n\nclass BulletListService extends Service {\n  boot() {\n    const shortCuts = this.container.get('ShortCuts');\n    // shortCuts.addShortCut({\n    //   \"Shift-Ctrl-8\": wrapInList(this.schema.nodes.bulletlist)\n    // });\n  }\n\n  register() {\n    this.container.bind('BulletList').to(BulletList);\n    const createNode = this.container.get('CreateNode');\n    createNode(\n      {\n        bulletlist: bulletListNode,\n      },\n      { toWaxSchema: true },\n    );\n  }\n}\n\nexport default BulletListService;\n","import Tools from '../../lib/Tools';\nimport { injectable } from 'inversify';\nimport { icons } from 'wax-prosemirror-components';\nimport { wrapInList } from 'prosemirror-schema-list';\nimport { Commands } from 'wax-prosemirror-utilities';\n\n@injectable()\nexport default class OrderedList extends Tools {\n  title = 'Wrap in ordered list';\n  content = icons.ordered_list;\n\n  get run() {\n    return (state, dispatch) => {\n      wrapInList(state.config.schema.nodes.orderedlist)(state, dispatch);\n    };\n  }\n\n  get enable() {\n    return state => {\n      return wrapInList(state.config.schema.nodes.orderedlist)(state);\n    };\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get active() {\n    return state => {\n      return Commands.blockActive(state.config.schema.nodes.orderedlist)(state);\n    };\n  }\n}\n","import Service from \"../../Service\";\nimport { wrapInList } from \"prosemirror-schema-list\";\nimport { orderedListNode } from \"wax-prosemirror-schema\";\nimport OrderedList from \"./OrderedList\";\n\nclass OrderedListService extends Service {\n  boot() {\n    const shortCuts = this.container.get(\"ShortCuts\");\n    // shortCuts.addShortCut({\n    //   \"Shift-Ctrl-9\": wrapInList(this.schema.nodes.orderedlist)\n    // });\n  }\n\n  register() {\n    this.container.bind(\"OrderedList\").to(OrderedList);\n    const createNode = this.container.get(\"CreateNode\");\n    createNode(\n      {\n        orderedlist: orderedListNode\n      },\n      { toWaxSchema: true }\n    );\n  }\n}\n\nexport default OrderedListService;\n","import { joinUp } from \"prosemirror-commands\";\nimport Tools from \"../../lib/Tools\";\nimport { injectable } from \"inversify\";\nimport { icons } from \"wax-prosemirror-components\";\n\n@injectable()\nexport default class JoinUp extends Tools {\n  title = \"Join with above block\";\n  content = icons.join_up;\n\n  get run() {\n    return joinUp;\n  }\n\n  get enable() {\n    return joinUp;\n  }\n\n  select(state) {\n    return joinUp(state);\n  }\n}\n","import Service from \"../../Service\";\nimport JoinUp from \"./JoinUp\";\n\nclass JoinUpService extends Service {\n  boot() {}\n\n  register() {\n    this.container.bind(\"JoinUp\").to(JoinUp);\n  }\n}\n\nexport default JoinUpService;\n","import { lift } from \"prosemirror-commands\";\nimport Tools from \"../../lib/Tools\";\nimport { injectable } from \"inversify\";\nimport { icons } from \"wax-prosemirror-components\";\n\n@injectable()\nexport default class Lift extends Tools {\n  title = \"Lift out of enclosing block\";\n  content = icons.lift;\n\n  get run() {\n    return lift;\n  }\n\n  get enable() {\n    return lift;\n  }\n}\n","import Service from \"../../Service\";\nimport { liftListItem, sinkListItem } from \"prosemirror-schema-list\";\nimport Lift from \"./Lift\";\n\nclass LiftService extends Service {\n  boot() {\n    const shortCuts = this.container.get(\"ShortCuts\");\n    // shortCuts.addShortCut({\n    //   \"Mod-[\": liftListItem(this.schema.nodes.list_item),\n    //   \"Mod-]\": sinkListItem(this.schema.nodes.list_item)\n    // });\n  }\n\n  register() {\n    this.container.bind(\"Lift\").to(Lift);\n  }\n}\n\nexport default LiftService;\n","import Service from \"../../Service\";\nimport { listItemNode } from \"wax-prosemirror-schema\";\n\nclass ListItemService extends Service {\n  boot() {}\n\n  register() {\n    const createNode = this.container.get(\"CreateNode\");\n    createNode(\n      {\n        list_item: listItemNode\n      },\n      { toWaxSchema: true }\n    );\n  }\n}\n\nexport default ListItemService;\n","import BulletListService from \"./BulletListService/BulletListService\";\nimport OrderedListService from \"./OrderedListService/OrderedListService\";\nimport JoinUpService from \"./JoinUpService/JoinUpService\";\nimport LiftService from \"./LiftService/LiftService\";\nimport ListItemService from \"./ListItemService/ListItemService\";\n\nexport default [\n  new BulletListService(),\n  new OrderedListService(),\n  new JoinUpService(),\n  new LiftService(),\n  new ListItemService()\n];\n","import Service from \"../Service\";\nimport ListsServices from \"./index\";\n\nclass ListsService extends Service {\n  dependencies = ListsServices;\n}\n\nexport default ListsService;\n","import { Commands } from 'wax-prosemirror-utilities';\nimport { injectable } from 'inversify';\nimport { icons } from 'wax-prosemirror-components';\nimport Tools from '../../lib/Tools';\n\nexport default\n@injectable()\nclass Table extends Tools {\n  title = 'Insert table';\n  content = icons.table;\n\n  get run() {\n    return (state, dispatch) => {\n      return Commands.createTable(state, dispatch);\n    };\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get enable() {\n    return state => {\n      return Commands.canInsert(state.config.schema.nodes.table)(state);\n    };\n  }\n}\n","import Service from \"../../Service\";\nimport { tableNodes, goToNextCell } from \"prosemirror-tables\";\nimport Table from \"./Table\";\n\nclass InsertTableService extends Service {\n  boot() {\n    const shortCuts = this.container.get(\"ShortCuts\");\n    shortCuts.addShortCut({\n      Tab: goToNextCell(1),\n      \"Shift-Tab\": goToNextCell(-1)\n    });\n  }\n\n  register() {\n    this.container.bind(\"Table\").to(Table);\n\n    const { table, table_row, table_cell, table_header } = tableNodes({\n      tableGroup: \"block\",\n      cellContent: \"block+\"\n    });\n    const createNode = this.container.get(\"CreateNode\");\n\n    createNode({\n      table\n    });\n    createNode({\n      table_row\n    });\n    createNode({\n      table_cell\n    });\n    createNode({\n      table_header\n    });\n  }\n}\n\nexport default InsertTableService;\n","import React from \"react\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { injectable } from \"inversify\";\nimport { isEmpty } from \"lodash\";\nimport { TableDropDown } from \"wax-prosemirror-components\";\nimport { addColumnBefore } from \"prosemirror-tables\";\nimport { Commands } from \"wax-prosemirror-utilities\";\nimport Tools from \"../../lib/Tools\";\n\n@injectable()\nexport default class TableDropDownOptions extends Tools {\n  title = \"Select Options\";\n  content = \"table\";\n\n  get run() {\n    return () => {\n      return true;\n    };\n  }\n\n  get enable() {\n    return state => {\n      return Commands.canInsert(state.config.schema.nodes.table)(state);\n    };\n  }\n\n  select(state) {\n    return addColumnBefore(state);\n  }\n\n  renderTool(view) {\n    if (isEmpty(view)) return null;\n    return this._isDisplayed ? (\n      <TableDropDown key={uuidv4()} item={this.toJSON()} view={view} />\n    ) : null;\n  }\n}\n","import Service from \"../../Service\";\nimport TableDropDownOptions from \"./TableDropDownOptions\";\n\nclass EditTableService extends Service {\n  boot() {}\n\n  register() {\n    this.container.bind(\"TableDropDownOptions\").to(TableDropDownOptions);\n  }\n}\n\nexport default EditTableService;\n","import InsertTableService from \"./InsertTableService/InsertTableService\";\nimport EditTableService from \"./EditTableService/EditTableService\";\n\nexport default [new InsertTableService(), new EditTableService()];\n","import Service from \"../Service\";\nimport TablesServices from \"./index\";\n\nclass TablesService extends Service {\n  dependencies = TablesServices;\n}\n\nexport default TablesService;\n","import Tools from '../../lib/Tools';\nimport { injectable } from 'inversify';\nimport { Commands } from 'wax-prosemirror-utilities';\n\n@injectable()\nclass ExtractPoetry extends Tools {\n  title = 'Change to Extract Poetry';\n  content = 'Extract Poetry';\n\n  get run() {\n    return (state, dispatch) => {\n      Commands.setBlockType(state.config.schema.nodes.extractPoetry, {\n        class: 'extract-poetry',\n      })(state, dispatch);\n    };\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get enable() {\n    return state => {\n      return Commands.setBlockType(state.config.schema.nodes.extractPoetry)(\n        state,\n      );\n    };\n  }\n}\nexport default ExtractPoetry;\n","import Service from \"../../Service\";\nimport { extractPoetryNode } from \"wax-prosemirror-schema\";\nimport ExtractPoetry from \"./ExtractPoetry\";\n\nclass ExtractPoetryService extends Service {\n  boot() {}\n\n  register() {\n    this.container.bind(\"ExtractPoetry\").to(ExtractPoetry);\n    const createNode = this.container.get(\"CreateNode\");\n    createNode(\n      {\n        extractPoetry: extractPoetryNode\n      },\n      { toWaxSchema: true }\n    );\n  }\n}\n\nexport default ExtractPoetryService;\n","import Tools from '../../lib/Tools';\nimport { injectable } from 'inversify';\nimport { Commands } from 'wax-prosemirror-utilities';\n\n@injectable()\nclass ExtractProse extends Tools {\n  title = 'Change to Extract Prose';\n  content = 'Extract Prose';\n\n  get run() {\n    return (state, dispatch) => {\n      Commands.setBlockType(state.config.schema.nodes.extractProse, {\n        class: 'extract-prose',\n      })(state, dispatch);\n    };\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get enable() {\n    return state => {\n      return Commands.setBlockType(state.config.schema.nodes.extractProse)(\n        state,\n      );\n    };\n  }\n}\nexport default ExtractProse;\n","import Service from \"../../Service\";\nimport { extractProseNode } from \"wax-prosemirror-schema\";\nimport ExtractProse from \"./ExtractProse\";\n\nclass ExtractProseService extends Service {\n  boot() {}\n\n  register() {\n    this.container.bind(\"ExtractProse\").to(ExtractProse);\n    const createNode = this.container.get(\"CreateNode\");\n    createNode(\n      {\n        extractProse: extractProseNode\n      },\n      { toWaxSchema: true }\n    );\n  }\n}\n\nexport default ExtractProseService;\n","import Tools from '../../lib/Tools';\nimport { injectable } from 'inversify';\nimport { Commands } from 'wax-prosemirror-utilities';\n\n@injectable()\nclass ParagraphContinued extends Tools {\n  title = 'Change to Paragraph Continued';\n  content = 'Paragraph Continued';\n\n  get run() {\n    return (state, dispatch) => {\n      Commands.setBlockType(state.config.schema.nodes.paragraphCont, {\n        class: 'paragraph-cont',\n      })(state, dispatch);\n    };\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get enable() {\n    return state => {\n      return Commands.setBlockType(state.config.schema.nodes.paragraphCont)(\n        state,\n      );\n    };\n  }\n}\n\nexport default ParagraphContinued;\n","import Service from \"../../Service\";\nimport { paragraphContNode } from \"wax-prosemirror-schema\";\nimport ParagraphContinued from \"./ParagraphContinued\";\n\nclass ParagraphContinuedService extends Service {\n  boot() {}\n\n  register() {\n    this.container.bind(\"ParagraphContinued\").to(ParagraphContinued);\n    const createNode = this.container.get(\"CreateNode\");\n    createNode(\n      {\n        paragraphCont: paragraphContNode\n      },\n      { toWaxSchema: true }\n    );\n  }\n}\n\nexport default ParagraphContinuedService;\n","import Tools from '../../lib/Tools';\nimport { injectable } from 'inversify';\nimport { Commands } from 'wax-prosemirror-utilities';\n\n@injectable()\nexport default class Paragraph extends Tools {\n  title = 'Change to Paragraph';\n  content = 'Paragraph';\n\n  get run() {\n    return (state, dispatch) => {\n      Commands.setBlockType(state.config.schema.nodes.paragraph, {\n        class: 'paragraph',\n      })(state, dispatch);\n    };\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get enable() {\n    return state => {\n      return Commands.setBlockType(state.config.schema.nodes.paragraph)(state);\n    };\n  }\n}\n","import Service from \"../../Service\";\nimport Paragraph from \"./Paragraph\";\n\nclass ParagraphService extends Service {\n  boot() {}\n\n  register() {\n    this.container.bind(\"Paragraph\").to(Paragraph);\n  }\n}\n\nexport default ParagraphService;\n","import Tools from '../../lib/Tools';\nimport { injectable } from 'inversify';\nimport { Commands } from 'wax-prosemirror-utilities';\n\n@injectable()\nclass SourceNote extends Tools {\n  title = 'Change to Source Note';\n  content = 'Source Note';\n\n  get run() {\n    return (state, dispatch) => {\n      Commands.setBlockType(state.config.schema.nodes.sourceNote, {\n        class: 'source-note',\n      })(state, dispatch);\n    };\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get enable() {\n    return state => {\n      return Commands.setBlockType(state.config.schema.nodes.sourceNote)(state);\n    };\n  }\n}\nexport default SourceNote;\n","import Service from \"../../Service\";\nimport { sourceNoteNode } from \"wax-prosemirror-schema\";\nimport SourceNote from \"./SourceNote\";\n\nclass SourceNoteService extends Service {\n  boot() {}\n\n  register() {\n    this.container.bind(\"SourceNote\").to(SourceNote);\n    const createNode = this.container.get(\"CreateNode\");\n    createNode(\n      {\n        sourceNote: sourceNoteNode\n      },\n      { toWaxSchema: true }\n    );\n  }\n}\n\nexport default SourceNoteService;\n","import Tools from '../../lib/Tools';\nimport { injectable } from 'inversify';\nimport { wrapIn } from 'prosemirror-commands';\n\n@injectable()\nclass BlockQuote extends Tools {\n  title = 'Change to Block Quote';\n  content = 'Block Quote';\n\n  get run() {\n    return (state, dispatch) => {\n      wrapIn(state.config.schema.nodes.blockquote)(state, dispatch);\n    };\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get enable() {\n    return state => {\n      return wrapIn(state.config.schema.nodes.blockquote)(state);\n    };\n  }\n}\nexport default BlockQuote;\n","import Service from \"../../Service\";\nimport { blockQuoteNode } from \"wax-prosemirror-schema\";\nimport BlockQuote from \"./BlockQuote\";\n\nclass BlockQuoteService extends Service {\n  boot() {}\n\n  register() {\n    this.container.bind(\"BlockQuote\").to(BlockQuote);\n    const createNode = this.container.get(\"CreateNode\");\n    createNode({\n      blockquote: blockQuoteNode\n    });\n  }\n}\n\nexport default BlockQuoteService;\n","import ExtractPoetryService from \"./ExtractPoetryService/ExtractPoetryService\";\nimport ExtractProseService from \"./ExtractProseService/ExtractProseService\";\nimport ParagraphContinuedService from \"./ParagraphContinuedService/ParagraphContinuedService\";\nimport ParagraphService from \"./ParagraphService/ParagraphService\";\nimport SourceNoteService from \"./SourceNoteService/SourceNoteService\";\nimport BlockQuoteService from \"./BlockQuoteService/BlockQuoteService\";\n\nexport default [\n  new ExtractPoetryService(),\n  new ExtractProseService(),\n  new ParagraphContinuedService(),\n  new ParagraphService(),\n  new SourceNoteService(),\n  new BlockQuoteService()\n];\n","import Service from \"../Service\";\nimport TextServices from \"./index\";\n\nclass TextBlockLevelService extends Service {\n  dependencies = TextServices;\n}\n\nexport default TextBlockLevelService;\n","import { injectable } from 'inversify';\nimport { Commands } from 'wax-prosemirror-utilities';\nimport Tools from '../../lib/Tools';\n\n@injectable()\nclass Author extends Tools {\n  title = 'Change to Author';\n  content = 'Author';\n\n  get run() {\n    return (state, dispatch) => {\n      Commands.setBlockType(state.config.schema.nodes.author, {\n        class: 'author',\n      })(state, dispatch);\n    };\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get enable() {\n    return state => {\n      return Commands.setBlockType(state.config.schema.nodes.author)(state);\n    };\n  }\n}\n\nexport default Author;\n","import { authorNode } from 'wax-prosemirror-schema';\nimport Service from '../../Service';\nimport Author from './Author';\n\nclass AuthorService extends Service {\n  // boot() {}\n\n  register() {\n    this.container.bind('Author').to(Author);\n    const createNode = this.container.get('CreateNode');\n    createNode(\n      {\n        author: authorNode,\n      },\n      { toWaxSchema: true },\n    );\n  }\n}\n\nexport default AuthorService;\n","import { injectable } from 'inversify';\nimport { Commands } from 'wax-prosemirror-utilities';\nimport Tools from '../../lib/Tools';\n\n@injectable()\nclass EpigraphPoetry extends Tools {\n  title = 'Change to Epigraph Poetry';\n  content = 'Epigraph Poetry';\n\n  get run() {\n    return (state, dispatch) => {\n      Commands.setBlockType(state.config.schema.nodes.epigraphPoetry, {\n        class: 'epigraph-poetry',\n      })(state, dispatch);\n    };\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get enable() {\n    return state => {\n      return Commands.setBlockType(state.config.schema.nodes.epigraphPoetry)(\n        state,\n      );\n    };\n  }\n}\n\nexport default EpigraphPoetry;\n","import { epigraphPoetryNode } from 'wax-prosemirror-schema';\nimport EpigraphPoetry from './EpigraphPoetry';\nimport Service from '../../Service';\n\nclass EpigraphPoetryService extends Service {\n  // boot() {}\n\n  register() {\n    this.container.bind('EpigraphPoetry').to(EpigraphPoetry);\n    const createNode = this.container.get('CreateNode');\n    createNode(\n      {\n        epigraphPoetry: epigraphPoetryNode,\n      },\n      { toWaxSchema: true },\n    );\n  }\n}\n\nexport default EpigraphPoetryService;\n","import { injectable } from 'inversify';\nimport { Commands } from 'wax-prosemirror-utilities';\nimport Tools from '../../lib/Tools';\n\nexport default\n@injectable()\nclass EpigraphProse extends Tools {\n  title = 'Change to Epigraph Prose';\n  content = 'Epigraph Prose';\n\n  get run() {\n    return (state, dispatch) => {\n      Commands.setBlockType(state.config.schema.nodes.epigraphProse, {\n        class: 'epigraph-prose',\n      })(state, dispatch);\n    };\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get enable() {\n    return state => {\n      return Commands.setBlockType(state.config.schema.nodes.epigraphProse)(\n        state,\n      );\n    };\n  }\n}\n","import { epigraphProseNode } from 'wax-prosemirror-schema';\nimport EpigraphProse from './EpigraphProse';\nimport Service from '../../Service';\n\nclass EpigraphProseService extends Service {\n  boot() {}\n\n  register() {\n    this.container.bind('EpigraphProse').to(EpigraphProse);\n    const createNode = this.container.get('CreateNode');\n    createNode(\n      {\n        epigraphProse: epigraphProseNode,\n      },\n      { toWaxSchema: true },\n    );\n  }\n}\n\nexport default EpigraphProseService;\n","import { injectable } from 'inversify';\nimport { Commands } from 'wax-prosemirror-utilities';\nimport Tools from '../../lib/Tools';\n\nexport default\n@injectable()\nclass Heading1 extends Tools {\n  title = 'Change to heading level 1';\n  content = 'Heading 1';\n\n  get run() {\n    return (state, dispatch) => {\n      Commands.setBlockType(state.config.schema.nodes.heading, { level: 1 })(\n        state,\n        dispatch,\n      );\n    };\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get enable() {\n    return state => {\n      return Commands.setBlockType(state.config.schema.nodes.heading, {\n        level: 1,\n      })(state);\n    };\n  }\n}\n","import { injectable } from 'inversify';\nimport { Commands } from 'wax-prosemirror-utilities';\nimport Tools from '../../lib/Tools';\n\nexport default\n@injectable()\nclass Heading2 extends Tools {\n  title = 'Change to heading level 2';\n  content = 'Heading 2';\n\n  get run() {\n    return (state, dispatch) => {\n      Commands.setBlockType(state.config.schema.nodes.heading, { level: 2 })(\n        state,\n        dispatch,\n      );\n    };\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get enable() {\n    return state => {\n      return Commands.setBlockType(state.config.schema.nodes.heading, {\n        level: 2,\n      })(state);\n    };\n  }\n}\n","import { injectable } from 'inversify';\nimport { Commands } from 'wax-prosemirror-utilities';\nimport Tools from '../../lib/Tools';\n\nexport default\n@injectable()\nclass Heading3 extends Tools {\n  title = 'Change to heading level 3';\n  content = 'Heading 3';\n\n  get run() {\n    return (state, dispatch) => {\n      Commands.setBlockType(state.config.schema.nodes.heading, { level: 3 })(\n        state,\n        dispatch,\n      );\n    };\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get enable() {\n    return state => {\n      return Commands.setBlockType(state.config.schema.nodes.heading, {\n        level: 3,\n      })(state);\n    };\n  }\n}\n","import { headingNode } from 'wax-prosemirror-schema';\nimport Heading1 from './Heading1';\nimport Heading2 from './Heading2';\nimport Heading3 from './Heading3';\nimport Service from '../../Service';\n\nclass HeadingService extends Service {\n  // boot() {}\n\n  register() {\n    this.container.bind('Heading1').to(Heading1);\n    this.container.bind('Heading2').to(Heading2);\n    this.container.bind('Heading3').to(Heading3);\n    const createNode = this.container.get('CreateNode');\n    createNode(\n      {\n        heading: headingNode,\n      },\n      { toWaxSchema: true },\n    );\n  }\n}\n\nexport default HeadingService;\n","import Tools from '../../lib/Tools';\nimport { injectable } from 'inversify';\nimport { Commands } from 'wax-prosemirror-utilities';\n\n@injectable()\nexport default class SubTitle extends Tools {\n  title = 'Change to Subtitle';\n  content = 'Subtitle';\n\n  get run() {\n    return (state, dispatch) => {\n      Commands.setBlockType(state.config.schema.nodes.subtitle, {\n        class: 'cst',\n      })(state, dispatch);\n    };\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get enable() {\n    return state => {\n      return Commands.setBlockType(state.config.schema.nodes.subtitle)(state);\n    };\n  }\n}\n","import Service from \"../../Service\";\nimport { subTitleNode } from \"wax-prosemirror-schema\";\nimport SubTitle from \"./SubTitle\";\n\nclass SubTitleService extends Service {\n  boot() {}\n\n  register() {\n    this.container.bind(\"SubTitle\").to(SubTitle);\n    const createNode = this.container.get(\"CreateNode\");\n    createNode(\n      {\n        subtitle: subTitleNode\n      },\n      { toWaxSchema: true }\n    );\n  }\n}\n\nexport default SubTitleService;\n","import Tools from '../../lib/Tools';\nimport { injectable } from 'inversify';\nimport { Commands } from 'wax-prosemirror-utilities';\n\n@injectable()\nexport default class Title extends Tools {\n  title = 'Change to Title';\n  content = 'Title';\n\n  get run() {\n    return (state, dispatch) => {\n      Commands.setBlockType(state.config.schema.nodes.title, {\n        class: 'title',\n      })(state, dispatch);\n    };\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get enable() {\n    return state => {\n      return Commands.setBlockType(state.config.schema.nodes.title)(state);\n    };\n  }\n}\n","import Service from \"../../Service\";\nimport { titleNode } from \"wax-prosemirror-schema\";\nimport Title from \"./Title\";\n\nclass TitleService extends Service {\n  boot() {}\n\n  register() {\n    this.container.bind(\"Title\").to(Title);\n    const createNode = this.container.get(\"CreateNode\");\n    createNode(\n      {\n        title: titleNode\n      },\n      { toWaxSchema: true }\n    );\n  }\n}\n\nexport default TitleService;\n","import AuthorService from \"./AuthorService/AuthorService\";\nimport EpigraphPoetryService from \"./EpigraphPoetryService/EpigraphPoetryService\";\nimport EpigraphProseService from \"./EpigraphProseService/EpigraphProseService\";\nimport HeadingService from \"./HeadingService/HeadingService\";\nimport SubTitleService from \"./SubTitleService/SubTitleService\";\nimport TitleService from \"./TitleService/TitleService\";\n\nexport default [\n  new AuthorService(),\n  new EpigraphProseService(),\n  new EpigraphPoetryService(),\n  new HeadingService(),\n  new SubTitleService(),\n  new TitleService()\n];\n","import Service from \"../Service\";\nimport DisplayServices from \"./index\";\n\nclass DisplayBlockLevelService extends Service {\n  // register() {\n  //   this.config.pushToArray(\"services\", DisplayServices);\n  // }\n  dependencies = DisplayServices;\n}\n\nexport default DisplayBlockLevelService;\n","import Tools from '../lib/Tools';\nimport { injectable } from 'inversify';\nimport { icons } from 'wax-prosemirror-components';\nimport { Fragment } from 'prosemirror-model';\nimport { v4 as uuidv4 } from 'uuid';\n\n@injectable()\nexport default class Note extends Tools {\n  title = 'Insert Note';\n  content = icons.footnote;\n\n  get run() {\n    return (state, dispatch) => {\n      let { empty, $from, $to } = state.selection,\n        content = Fragment.empty;\n      if (!empty && $from.sameParent($to) && $from.parent.inlineContent)\n        content = $from.parent.content.cut(\n          $from.parentOffset,\n          $to.parentOffset,\n        );\n      const footnote = state.config.schema.nodes.footnote.create(\n        { id: uuidv4() },\n        content,\n      );\n      dispatch(state.tr.replaceSelectionWith(footnote));\n    };\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get enable() {\n    return state => {\n      return true;\n    };\n  }\n}\n","import { forEach } from \"lodash\";\nimport { v4 as uuidv4 } from \"uuid\";\nimport { DocumentHelpers } from \"wax-prosemirror-utilities\";\n\nconst transformPasted = (slice, view) => {\n  const { content } = slice;\n  const commentNodes = DocumentHelpers.findChildrenByMark(\n    content,\n    view.state.schema.marks.comment,\n    true\n  );\n\n  const allComments = [];\n\n  commentNodes.map(node => {\n    node.node.marks.map(comment => {\n      if (comment.type.name === \"comment\") {\n        allComments.push(comment);\n      }\n    });\n  });\n\n  let groupedCommentsById = allComments.reduce((obj, mark) => {\n    obj[mark.attrs.id] = [...(obj[mark.attrs.id] || []), mark];\n    return obj;\n  }, {});\n\n  forEach(Object.keys(groupedCommentsById), key => {\n    let id = uuidv4();\n    forEach(groupedCommentsById[key], comment => {\n      comment.attrs.id = id;\n    });\n  });\n\n  return slice;\n};\n\nexport default transformPasted;\n","/* eslint react/prop-types: 0 */\nimport React, { useEffect, useRef, useContext } from 'react';\nimport { filter } from 'lodash';\nimport { EditorView } from 'prosemirror-view';\nimport { EditorState } from 'prosemirror-state';\nimport { StepMap } from 'prosemirror-transform';\nimport { baseKeymap } from 'prosemirror-commands';\nimport { keymap } from 'prosemirror-keymap';\nimport { undo, redo } from 'prosemirror-history';\nimport { WaxContext } from 'wax-prosemirror-core';\nimport { NoteEditorContainer } from 'wax-prosemirror-components';\nimport { DocumentHelpers } from 'wax-prosemirror-utilities';\nimport trackedTransaction from '../TrackChangeService/track-changes/trackedTransaction';\nimport transformPasted from './helpers/TransformPasted';\n\nexport default ({ node, view }) => {\n  const editorRef = useRef();\n  const context = useContext(WaxContext);\n  const noteId = node.attrs.id;\n  let noteView;\n  useEffect(() => {\n    noteView = new EditorView(\n      { mount: editorRef.current },\n      {\n        state: EditorState.create({\n          doc: node,\n          plugins: [keymap(createKeyBindings()), ...context.app.getPlugins()],\n        }),\n        // This is the magic part\n        dispatchTransaction,\n        handleDOMEvents: {\n          mousedown: () => {\n            context.updateView({}, noteId);\n\n            // Kludge to prevent issues due to the fact that the whole\n            // footnote is node-selected (and thus DOM-selected) when\n            // the parent editor is focused.\n            if (noteView.hasFocus()) noteView.focus();\n          },\n        },\n        transformPasted: slice => {\n          return transformPasted(slice, noteView);\n        },\n      },\n    );\n\n    // Set Each note into Wax's Context\n    context.updateView(\n      {\n        [noteId]: noteView,\n      },\n      noteId,\n    );\n    if (context.view[noteId]) {\n      context.view[noteId].focus();\n    }\n  }, []);\n\n  const dispatchTransaction = transaction => {\n    // const tr = TrackChange.enabled\n    //   ? trackedTransaction(transaction, view.state, user)\n    //   : transaction;\n\n    const { state, transactions } = noteView.state.applyTransaction(\n      transaction,\n    );\n    noteView.updateState(state);\n\n    const allNotes = DocumentHelpers.findChildrenByType(\n      view.state.doc,\n      view.state.schema.nodes.footnote,\n      true,\n    );\n\n    const noteFound = filter(allNotes, {\n      node: { attrs: { id: noteId } },\n    });\n\n    // TODO Remove timeout and use state to check if noteView has changed\n    setTimeout(() => {\n      context.updateView({}, noteId);\n    }, 20);\n\n    if (!transaction.getMeta('fromOutside')) {\n      const outerTr = view.state.tr;\n      const offsetMap = StepMap.offset(noteFound[0].pos + 1);\n      for (let i = 0; i < transactions.length; i + 1) {\n        const { steps } = transactions[i];\n        for (let j = 0; j < steps.length; j + 1)\n          outerTr.step(steps[j].map(offsetMap));\n      }\n\n      if (outerTr.docChanged)\n        view.dispatch(outerTr.setMeta('outsideView', 'notes'));\n    }\n  };\n\n  const createKeyBindings = () => {\n    const keys = getKeys();\n    Object.keys(baseKeymap).forEach(key => {\n      keys[key] = baseKeymap[key];\n    });\n    return keys;\n  };\n\n  const getKeys = () => {\n    return {\n      'Mod-z': () => undo(view.state, view.dispatch),\n      'Mod-y': () => redo(view.state, view.dispatch),\n      // 'Mod-u': () => Commands.markActive(noteView.state.config.schema.marks.underline)(noteView.state),\n    };\n  };\n\n  if (context.view[noteId]) {\n    const { state } = context.view[noteId];\n    const start = node.content.findDiffStart(state.doc.content);\n    if (start != null) {\n      let { a: endA, b: endB } = node.content.findDiffEnd(state.doc.content);\n      const overlap = start - Math.min(endA, endB);\n      if (overlap > 0) {\n        endA += overlap;\n        endB += overlap;\n      }\n      context.view[noteId].dispatch(\n        state.tr\n          .replace(start, endB, node.slice(start, endA))\n          .setMeta('fromOutside', true),\n      );\n    }\n  }\n\n  return <NoteEditorContainer ref={editorRef} />;\n};\n","import React, { Fragment } from \"react\";\nimport Editor from \"./Editor\";\n\nexport default ({ notes, view }) => {\n  return (\n    <Fragment>\n      {notes.map(note => (\n        <Editor key={note.node.attrs.id} node={note.node} view={view} />\n      ))}\n    </Fragment>\n  );\n};\n","import React, {\n  useContext,\n  useState,\n  useEffect,\n  useMemo,\n  Fragment\n} from \"react\";\nimport { WaxContext } from \"wax-prosemirror-core\";\nimport { DocumentHelpers } from \"wax-prosemirror-utilities\";\nimport NoteEditor from \"./NoteEditor\";\n\nexport default () => {\n  const { view: { main } } = useContext(WaxContext);\n  const [notes, setNotes] = useState([]);\n  useEffect(\n    () => {\n      setNotes(updateNotes(main));\n    },\n\n    [JSON.stringify(updateNotes(main))]\n  );\n\n  const noteComponent = useMemo(\n    () => <NoteEditor notes={notes} view={main} />,\n    [notes]\n  );\n  return <Fragment>{noteComponent}</Fragment>;\n};\nconst updateNotes = view => {\n  if (view) {\n    return DocumentHelpers.findChildrenByType(\n      view.state.doc,\n      view.state.schema.nodes.footnote,\n      true\n    );\n  }\n  return [];\n};\n","import Service from \"../Service\";\nimport { footNoteNode } from \"wax-prosemirror-schema\";\nimport { CommentBubbleComponent } from \"wax-prosemirror-components\";\nimport Note from \"./Note\";\nimport NoteComponent from \"./NoteComponent\";\n\nclass NoteService extends Service {\n  name = \"NoteService\";\n\n  boot() {\n    const layout = this.container.get(\"Layout\");\n    const createOverlay = this.container.get(\"CreateOverlay\");\n    layout.addComponent(\"notesArea\", NoteComponent);\n    createOverlay(\n      CommentBubbleComponent,\n      {\n        showComment: activeViewId => activeViewId !== \"main\",\n        group: \"notes\"\n      },\n      {\n        markType: \"\",\n        followCursor: false,\n        selection: true\n      }\n    );\n  }\n\n  register() {\n    const createNode = this.container.get(\"CreateNode\");\n    this.container.bind(\"Note\").to(Note);\n\n    createNode({\n      footnote: footNoteNode\n    });\n  }\n}\n\nexport default NoteService;\n","import { commentMark } from 'wax-prosemirror-schema';\nimport { RightArea, CommentBubbleComponent } from 'wax-prosemirror-components';\nimport { CommentPlugin } from 'wax-prosemirror-plugins';\nimport Service from '../Service';\n\nconst PLUGIN_KEY = 'commentPlugin';\n\nexport default class CommentsService extends Service {\n  boot() {\n    this.app.PmPlugins.add(PLUGIN_KEY, CommentPlugin(PLUGIN_KEY));\n    const createOverlay = this.container.get('CreateOverlay');\n    const layout = this.container.get('Layout');\n    createOverlay(\n      CommentBubbleComponent,\n      {\n        showComment: activeViewId => activeViewId === 'main',\n        group: 'main',\n      },\n      {\n        markType: '',\n        followCursor: false,\n        selection: true,\n      },\n    );\n    layout.addComponent('rightArea', RightArea);\n  }\n\n  register() {\n    const createMark = this.container.get('CreateMark');\n    createMark(\n      {\n        comment: commentMark,\n      },\n      { toWaxSchema: true },\n    );\n  }\n}\n","import { injectable } from 'inversify';\nimport { icons } from 'wax-prosemirror-components';\nimport { setBlockType } from 'prosemirror-commands';\nimport Tools from '../lib/Tools';\n\n@injectable()\nclass CodeBlockTool extends Tools {\n  title = 'Insert Code Block';\n  content = icons.code_block;\n\n  get run() {\n    return (state, dispatch) => {\n      setBlockType(state.config.schema.nodes.code_block)(state, dispatch);\n    };\n  }\n\n  select = (state, activeViewId) => {\n    if (activeViewId !== 'main') return false;\n    return true;\n  };\n\n  get enable() {\n    return state => {\n      return setBlockType(state.config.schema.nodes.code_block)(state);\n    };\n  }\n}\n\nexport default CodeBlockTool;\n","import { highlightPlugin } from 'wax-prosemirror-plugins';\nimport 'highlight.js/styles/github.css';\n\nimport { codeBlockNode } from 'wax-prosemirror-schema';\nimport Service from '../Service';\nimport CodeBlockTool from './CodeBlockTool';\n\nexport default class CodeBlockService extends Service {\n  boot() {\n    this.app.PmPlugins.add('highlightPlugin', highlightPlugin());\n  }\n\n  register() {\n    this.container.bind('CodeBlockTool').to(CodeBlockTool);\n    const createNode = this.container.get('CreateNode');\n\n    createNode({\n      code_block: codeBlockNode,\n    });\n  }\n}\n","import { injectable, inject } from 'inversify';\nimport ToolGroup from '../../lib/ToolGroup';\n\n@injectable()\nclass Base extends ToolGroup {\n  tools = [];\n  constructor(@inject('Undo') undo, @inject('Redo') redo) {\n    super();\n    this.tools = [undo, redo];\n  }\n}\n\nexport default Base;\n","import Service from '../../Service';\nimport Base from './Base';\n\nclass BaseToolGroupService extends Service {\n  register() {\n    this.container.bind('Base').to(Base);\n  }\n}\n\nexport default BaseToolGroupService;\n","import { injectable, inject } from \"inversify\";\nimport ToolGroup from \"../../lib/ToolGroup\";\n\n@injectable()\nclass Annotations extends ToolGroup {\n  tools = [];\n  constructor(\n    @inject(\"Code\") code,\n    @inject(\"Emphasis\") emphasis,\n    @inject(\"Link\") link,\n    @inject(\"StrikeThrough\") strikethrough,\n    @inject(\"Strong\") strong,\n    @inject(\"Subscript\") subscript,\n    @inject(\"Superscript\") superscript,\n    @inject(\"Underline\") underline,\n    @inject(\"SmallCaps\") smallcaps\n  ) {\n    super();\n    this.tools = [\n      strong,\n      emphasis,\n      code,\n      link,\n      strikethrough,\n      underline,\n      subscript,\n      superscript,\n      smallcaps\n    ];\n  }\n}\n\nexport default Annotations;\n","import Service from \"../../Service\";\nimport Annotations from \"./Annotations\";\n\nclass AnnotationToolGroupService extends Service {\n  name = \"AnnotationToolGroupService\";\n\n  register() {\n    this.container.bind(\"Annotations\").to(Annotations);\n  }\n}\n\nexport default AnnotationToolGroupService;\n","import { injectable, inject } from \"inversify\";\nimport ToolGroup from \"../../lib/ToolGroup\";\n\n@injectable()\nclass Lists extends ToolGroup {\n  tools = [];\n  constructor(\n    @inject(\"OrderedList\") orderedlist,\n    @inject(\"BulletList\") bulletlist,\n    @inject(\"JoinUp\") joinup,\n    @inject(\"Lift\") lift\n  ) {\n    super();\n    this.tools = [orderedlist, bulletlist, joinup, lift];\n  }\n}\n\nexport default Lists;\n","import Service from '../../Service';\nimport Lists from './Lists';\n\nclass ListToolGroupService extends Service {\n  register() {\n    this.container.bind('Lists').to(Lists);\n  }\n}\n\nexport default ListToolGroupService;\n","import { injectable, inject } from \"inversify\";\nimport ToolGroup from \"../../lib/ToolGroup\";\n\n@injectable()\nclass Images extends ToolGroup {\n  tools = [];\n  constructor(@inject(\"Image\") image) {\n    super();\n    this.tools = [image];\n  }\n}\n\nexport default Images;\n","import Service from '../../Service';\nimport Images from './Images';\n\nclass ImageToolGroupService extends Service {\n  register() {\n    this.container.bind('Images').to(Images);\n  }\n}\n\nexport default ImageToolGroupService;\n","import { injectable, inject } from \"inversify\";\nimport ToolGroup from \"../../lib/ToolGroup\";\n\n@injectable()\nclass Tables extends ToolGroup {\n  tools = [];\n  constructor(\n    @inject(\"Table\") table,\n    @inject(\"TableDropDownOptions\") tableDropDownOptions\n  ) {\n    super();\n    this.tools = [table, tableDropDownOptions];\n  }\n}\n\nexport default Tables;\n","import Service from '../../Service';\nimport Tables from './Tables';\n\nclass TableToolGroupService extends Service {\n  register() {\n    this.container.bind('Tables').to(Tables);\n  }\n}\n\nexport default TableToolGroupService;\n","import React from \"react\";\nimport { injectable, inject } from \"inversify\";\nimport { LeftMenuTitle } from \"wax-prosemirror-components\";\nimport ToolGroup from \"../../lib/ToolGroup\";\n\n@injectable()\nclass Display extends ToolGroup {\n  tools = [];\n  title = <LeftMenuTitle title=\"Display\" />;\n\n  constructor(\n    @inject(\"Author\") author,\n    @inject(\"Title\") title,\n    @inject(\"SubTitle\") subtitle,\n    @inject(\"EpigraphProse\") epigraphprose,\n    @inject(\"EpigraphPoetry\") epigraphpoetry,\n    @inject(\"Heading1\") heading1,\n    @inject(\"Heading2\") heading2,\n    @inject(\"Heading3\") heading3\n  ) {\n    super();\n    this.tools = [\n      title,\n      author,\n      subtitle,\n      epigraphprose,\n      epigraphpoetry,\n      heading1,\n      heading2,\n      heading3\n    ];\n  }\n}\n\nexport default Display;\n","import Service from '../../Service';\nimport Display from './Display';\n\nclass DisplayToolGroupService extends Service {\n  register() {\n    this.container.bind('Display').to(Display);\n  }\n}\n\nexport default DisplayToolGroupService;\n","import React from \"react\";\nimport { injectable, inject } from \"inversify\";\nimport { LeftMenuTitle } from \"wax-prosemirror-components\";\nimport ToolGroup from \"../../lib/ToolGroup\";\n\n@injectable()\nclass Text extends ToolGroup {\n  tools = [];\n  title = <LeftMenuTitle title=\"Text\" />;\n\n  constructor(\n    @inject(\"Paragraph\") paragraph,\n    @inject(\"ParagraphContinued\") paragraphContinued,\n    @inject(\"ExtractProse\") extractProse,\n    @inject(\"ExtractPoetry\") extractPoetry,\n    @inject(\"SourceNote\") sourceNote,\n    @inject(\"BlockQuote\") blockQuote\n  ) {\n    super();\n    this.tools = [\n      paragraph,\n      paragraphContinued,\n      extractProse,\n      extractPoetry,\n      sourceNote,\n      blockQuote\n    ];\n  }\n}\n\nexport default Text;\n","import Service from '../../Service';\nimport Text from './Text';\n\nclass TextToolGroupService extends Service {\n  register() {\n    this.container.bind('Text').to(Text);\n  }\n}\n\nexport default TextToolGroupService;\n","import { injectable, inject } from \"inversify\";\nimport ToolGroup from \"../../lib/ToolGroup\";\n\n@injectable()\nclass Notes extends ToolGroup {\n  tools = [];\n  constructor(@inject(\"Note\") note) {\n    super();\n    this.tools = [note];\n  }\n}\n\nexport default Notes;\n","import Service from '../../Service';\nimport Notes from './Notes';\n\nclass NoteToolGroupService extends Service {\n  register() {\n    this.container.bind('Notes').to(Notes);\n  }\n}\n\nexport default NoteToolGroupService;\n","import { injectable, inject } from 'inversify';\nimport ToolGroup from '../../lib/ToolGroup';\n\n@injectable()\nclass CodeBlock extends ToolGroup {\n  tools = [];\n  constructor(@inject('CodeBlockTool') codeblock) {\n    super();\n    this.tools = [codeblock];\n  }\n}\n\nexport default CodeBlock;\n","import Service from '../../Service';\nimport CodeBlock from './CodeBlock';\n\nclass CodeBlockToolGroupService extends Service {\n  register() {\n    this.container.bind('CodeBlock').to(CodeBlock);\n  }\n}\n\nexport default CodeBlockToolGroupService;\n","import { injectable, inject } from 'inversify';\nimport ToolGroup from '../../lib/ToolGroup';\n\n@injectable()\nclass TrackChange extends ToolGroup {\n  tools = [];\n  constructor(\n    @inject('EnableTrackChange') enableTrackChange,\n    @inject('AcceptTrackChange') acceptTrackChange,\n    @inject('RejectTrackChange') rejectTrackChange,\n  ) {\n    super();\n    this.tools = [enableTrackChange, acceptTrackChange, rejectTrackChange];\n  }\n}\n\nexport default TrackChange;\n","import Service from '../../Service';\nimport TrackChange from './TrackChange';\n\nclass TrackChangeToolGroupService extends Service {\n  register() {\n    this.container.bind('TrackChange').to(TrackChange);\n  }\n}\n\nexport default TrackChangeToolGroupService;\n"],"names":["_classCallCheck","instance","Constructor","TypeError","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","protoProps","staticProps","prototype","Service","app","container","config","get","name","getSchema","_setPrototypeOf","o","p","setPrototypeOf","__proto__","_inherits","subClass","superClass","create","constructor","value","_getPrototypeOf","getPrototypeOf","_isNativeReflectConstruct","Reflect","construct","sham","Proxy","Date","toString","call","e","_typeof","obj","Symbol","iterator","_assertThisInitialized","self","ReferenceError","_possibleConstructorReturn","assertThisInitialized","_createSuper","Derived","Super","result","isNativeReflectConstruct","NewTarget","arguments","apply","possibleConstructorReturn","ComponentPlugin","renderArea","layoutProps","useInjection","components","render","map","Component","component","componentProps","React","DefaultLayout","editor","Layout","injectable","layoutComponent","LayoutFactory","createArea","size","set","getArray","area","Map","forEach","push","LayoutService","bind","to","inSingletonScope","ToolGroup","_config","title","_tools","exclude","include","tool","includes","displayTool","hideTool","more","hideInToolGroup","displayInToolGroup","view","ToolGroupComponent","uuidv4","tools","_taggedTemplateLiteral","strings","raw","slice","freeze","defineProperties","MainMenu","styled","div","MainMenuBar","items","item","renderTools","Menu","createTools","toolGroups","excludeIncludeTools","addToolIntoMore","toolGroup","useContext","WaxContext","main","activeView","Bar","useMemo","MenuWrapper","MenuCollection","menus","multiInject","find","menu","MenuService","layout","addComponent","templateArea","conf","toFactory","context","configTools","tl","isPlainObject","setGroupConfig","isFunction","error","Error","Tools","content","_isDisplayed","_isHiddenInToolGroup","onlyOnMain","pmplugins","inject","active","run","enable","select","isEmpty","Button","toJSON","LinkTool","icons","link","state","dispatch","Commands","markActive","schema","marks","toggleMark","createLink","isOnSameTextBlock","LinkService","createOverlay","LinkComponent","markType","followCursor","selection","createMark","linkMark","toWaxSchema","Plugin","PluginKey","init","DecorationSet","empty","tr","mapping","doc","action","getMeta","add","widget","document","createElement","deco","Decoration","pos","id","remove","spec","decorations","getState","PLUGIN_KEY","PlaceholderService","PmPlugins","placeholderPlugin","_arrayWithHoles","arr","Array","isArray","_iterableToArrayLimit","_arr","_n","_d","_e","undefined","_i","_s","next","done","err","_arrayLikeToArray","len","arr2","_unsupportedIterableToArray","minLen","arrayLikeToArray","n","from","test","_nonIterableRest","_slicedToArray","arrayWithHoles","iterableToArrayLimit","unsupportedIterableToArray","nonIterableRest","_defineProperty","ownKeys","object","enumerableOnly","keys","getOwnPropertySymbols","symbols","filter","sym","getOwnPropertyDescriptor","_objectSpread2","source","getOwnPropertyDescriptors","defaultOverlay","left","top","mark","options","useState","position","setPosition","calculatePosition","WaxSurface","dom","getBoundingClientRect","start","coordsAtPos","end","displayOnSelection","displayOnMark","PMmark","DocumentHelpers","getSelectionMark","isObject","updatePosition","useCallback","useLayoutEffect","JSON","stringify","usePosition","visible","Overlay","OverlayService","OverlayComponent","findPlaceholder","decos","found","fileUpload","file","deleteSelection","setMeta","then","url","replaceWith","nodes","image","src","Image","activeViewId","upload","ImageUpload","canInsert","ImageService","createNode","imageNode","_arrayWithoutHoles","_iterableToArray","iter","_nonIterableSpread","_toConsumableArray","arrayWithoutHoles","iterableToArray","nonIterableSpread","Rules","plugins","extendedRules","allRules","rules","rulesCreated","inputRules","smartQuotes","wrappingInputRule","blockquote","orderedlist","match","order","node","childCount","attrs","bulletlist","textblockTypeInputRule","RegExp","heading","level","RulesService","configRules","addRule","createRules","toDynamicValue","text","group","hard_break","inline","selectable","parseDOM","tag","toDOM","paragraph","track","getAttrs","dataset","getAttribute","SchemaHelpers","parseTracks","blockLevelToDOM","Middleware","last","reduceOneRight","fn","go","stack","args","_next","ParseRule","style","exporter","defaultMiddleware","hook","addStack","use","rule","hooks","omit","parseSchema","Node","importer","atom","isolating","draggable","_attrs","_parseRules","combineRules","assign","parseDom","values","parseRule","Mark","inclusive","Schema","_nodes","_marks","prosemirrorSchema","schemaConfig","nd","has","fromJSON","addSchema","mr","type","DefaultSchema","index","PmPschema","SchemaService","schemaInstance","addNode","addProsemirrorSchema","addMark","backSpace","chainCommands","joinBackward","selectNodeBackward","backSpaceShortCut","undoShortCut","undo","redoShortCut","redo","ShortCuts","insertBreak","insertRule","getKeys","br","replaceSelectionWith","scrollIntoView","hr","horizontal_rule","shortCuts","keymap","createKeyBindings","shortcut","createShortCuts","baseKeymap","Backspace","Escape","selectParentNode","exitCode","liftListItem","list_item","sinkListItem","Enter","splitListItem","wrapInList","ShortCutsService","EnableTrackChange","TrackChangeEnable","enabled","EnableTrackChangeService","removeNode","nodePos","newNodePos","selectionBefore","Selection","findFrom","resolve","$anchor","delStep","replaceStep","step","stepMap","getMap","appendMap","AcceptTrackChange","Mapping","nodesBetween","deletionStep","ReplaceStep","Math","max","min","nodeSize","Slice","setNodeMarkup","insertionMark","RemoveMarkStep","formatChangeMark","blockChangeTrack","steps","AcceptTrackChangeService","RejectTrackChange","deletionMark","before","oldMark","AddMarkStep","after","newMark","RejectTrackChangeService","TrackChangeService","dependencies","TrackChangeServices","trackChangesMarks","trackChangesNodes","markDeletion","user","date","deletion","userId","username","deletionMap","isInline","removeStep","maybeStep","failed","trackAttr","isTextblock","TextSelection","counter","markInsertion","removeMark","insertion","newTr","cellDeleteTr","CellSelection","deletionMarkSchema","findMark","positionTo","newStep","structure","invert","trTemp","mappedNewStepTo","condensedStep","mirrorIndex","maps","eq","setSelection","markWrapping","oldNode","newNode","blockTrack","replaceAroundStep","gapFrom","gapTo","nodeAt","firstChild","console","log","addMarkStep","markName","concat","format_change","removeMarkStep","trackedTransaction","meta","every","metadata","floor","now","originalStep","ReplaceAroundStep","selectionSet","caretPos","$head","depth","storedMarksSet","setStoredMarks","storedMarks","scrolledIntoView","Undo","UndoService","Redo","RedoService","Save","save","BaseService","BaseServices","Code","code","CodeService","addShortCut","codeMark","Strong","strong","StrongService","strongMark","Emphasis","em","EmphasisService","emphasisMark","Subscript","subscript","SubscriptService","subscriptMark","Superscript","superscript","SuperscriptService","superscriptMark","StrikeThrough","strikethrough","StrikeThroughService","strikethroughMark","Underline","underline","UnderlineService","underlineMark","SmallCaps","small_caps","smallcaps","SmallCapsService","smallcapsMark","InlineAnnotationsService","InlineServices","BulletList","bullet_list","blockActive","BulletListService","bulletListNode","OrderedList","ordered_list","OrderedListService","orderedListNode","JoinUp","join_up","joinUp","JoinUpService","Lift","lift","LiftService","ListItemService","listItemNode","ListsService","ListsServices","Table","table","createTable","InsertTableService","Tab","goToNextCell","tableNodes","tableGroup","cellContent","table_row","table_cell","table_header","TableDropDownOptions","addColumnBefore","TableDropDown","EditTableService","TablesService","TablesServices","ExtractPoetry","setBlockType","extractPoetry","ExtractPoetryService","extractPoetryNode","ExtractProse","extractProse","ExtractProseService","extractProseNode","ParagraphContinued","paragraphCont","ParagraphContinuedService","paragraphContNode","Paragraph","ParagraphService","SourceNote","sourceNote","SourceNoteService","sourceNoteNode","BlockQuote","wrapIn","BlockQuoteService","blockQuoteNode","TextBlockLevelService","TextServices","Author","author","AuthorService","authorNode","EpigraphPoetry","epigraphPoetry","EpigraphPoetryService","epigraphPoetryNode","EpigraphProse","epigraphProse","EpigraphProseService","epigraphProseNode","Heading1","Heading2","Heading3","HeadingService","headingNode","SubTitle","subtitle","SubTitleService","subTitleNode","Title","TitleService","titleNode","DisplayBlockLevelService","DisplayServices","Note","footnote","$from","$to","Fragment","sameParent","parent","inlineContent","cut","parentOffset","transformPasted","commentNodes","findChildrenByMark","comment","allComments","groupedCommentsById","reduce","editorRef","useRef","noteId","noteView","useEffect","EditorView","mount","current","EditorState","getPlugins","dispatchTransaction","handleDOMEvents","mousedown","updateView","hasFocus","focus","transaction","applyTransaction","transactions","updateState","allNotes","findChildrenByType","noteFound","setTimeout","outerTr","offsetMap","StepMap","offset","j","docChanged","findDiffStart","findDiffEnd","endA","a","endB","b","overlap","replace","NoteEditorContainer","notes","note","setNotes","updateNotes","noteComponent","NoteService","NoteComponent","CommentBubbleComponent","showComment","footNoteNode","CommentsService","CommentPlugin","RightArea","commentMark","CodeBlockTool","code_block","CodeBlockService","highlightPlugin","codeBlockNode","Base","BaseToolGroupService","Annotations","emphasis","AnnotationToolGroupService","Lists","joinup","ListToolGroupService","Images","ImageToolGroupService","Tables","tableDropDownOptions","TableToolGroupService","Display","LeftMenuTitle","epigraphprose","epigraphpoetry","heading1","heading2","heading3","DisplayToolGroupService","Text","paragraphContinued","blockQuote","TextToolGroupService","Notes","NoteToolGroupService","CodeBlock","codeblock","CodeBlockToolGroupService","TrackChange","enableTrackChange","acceptTrackChange","rejectTrackChange","TrackChangeToolGroupService"],"mappings":"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"}